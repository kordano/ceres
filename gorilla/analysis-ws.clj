;; gorilla-repl.fileformat = 1

;; **
;;; # News Diffusion on Twitter
;; **

;; @@
(ns unsightly-reserve
  (:refer-clojure :exclude [find sort])
  (:require [gorilla-plot.core :as plot]
            [ceres.collector :refer :all]
            [ceres.curator :refer [random-tree build-tree-from-source compute-summary]]
            [ceres.analyzer :as analyzer :refer [short-metrics]]
            [monger.collection :as mc]
            [clojure.walk :as walk]
            [clojure.zip :as zip]
            [clj-time.core :as t]
            [clj-time.periodic :as p]
            [incanter.stats :refer [mean median quantile variance]]
            [monger.operators :refer :all]
            [monger.query :refer :all])
  (:import org.bson.types.ObjectId))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; Follwing news distributors are watched
;; **

;; @@
news-accounts
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-set'>#{</span>","close":"<span class='clj-set'>}</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;dpa&quot;</span>","value":"\"dpa\""},{"type":"html","content":"<span class='clj-string'>&quot;tazgezwitscher&quot;</span>","value":"\"tazgezwitscher\""},{"type":"html","content":"<span class='clj-string'>&quot;BILD&quot;</span>","value":"\"BILD\""},{"type":"html","content":"<span class='clj-string'>&quot;ZDFheute&quot;</span>","value":"\"ZDFheute\""},{"type":"html","content":"<span class='clj-string'>&quot;FAZ_NET&quot;</span>","value":"\"FAZ_NET\""},{"type":"html","content":"<span class='clj-string'>&quot;focusonline&quot;</span>","value":"\"focusonline\""},{"type":"html","content":"<span class='clj-string'>&quot;welt&quot;</span>","value":"\"welt\""},{"type":"html","content":"<span class='clj-string'>&quot;N24_de&quot;</span>","value":"\"N24_de\""},{"type":"html","content":"<span class='clj-string'>&quot;DerWesten&quot;</span>","value":"\"DerWesten\""},{"type":"html","content":"<span class='clj-string'>&quot;SPIEGELONLINE&quot;</span>","value":"\"SPIEGELONLINE\""},{"type":"html","content":"<span class='clj-string'>&quot;ntvde&quot;</span>","value":"\"ntvde\""},{"type":"html","content":"<span class='clj-string'>&quot;tagesschau&quot;</span>","value":"\"tagesschau\""},{"type":"html","content":"<span class='clj-string'>&quot;SZ&quot;</span>","value":"\"SZ\""},{"type":"html","content":"<span class='clj-string'>&quot;sternde&quot;</span>","value":"\"sternde\""}],"value":"#{\"dpa\" \"tazgezwitscher\" \"BILD\" \"ZDFheute\" \"FAZ_NET\" \"focusonline\" \"welt\" \"N24_de\" \"DerWesten\" \"SPIEGELONLINE\" \"ntvde\" \"tagesschau\" \"SZ\" \"sternde\"}"}
;; <=

;; **
;;; ## Average Tweets per Day
;; **

;; @@
(def start-date (t/date-time 2014 8 1))
(def end-date (t/date-time 2014 9 1))
(def days-running (t/in-days (t/interval start-date end-date)))
(def dates (take days-running (p/periodic-seq start-date (t/days 1))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/dates</span>","value":"#'unsightly-reserve/dates"}
;; <=

;; **
;;; ### Combined
;; **

;; @@
(let [tweet-count (map #(mc/count @db "tweets" {:created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
        days (range  2 (inc (inc days-running)))]
    (plot/list-plot tweet-count :joined true :plot-size 900))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"c6a82d22-4bd3-4c92-bb61-12d86b5494bd","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"c6a82d22-4bd3-4c92-bb61-12d86b5494bd","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"c6a82d22-4bd3-4c92-bb61-12d86b5494bd"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"c6a82d22-4bd3-4c92-bb61-12d86b5494bd","values":[{"x":0,"y":8774},{"x":1,"y":6783},{"x":2,"y":9144},{"x":3,"y":9718},{"x":4,"y":9909},{"x":5,"y":11237},{"x":6,"y":10819},{"x":7,"y":9143},{"x":8,"y":6782},{"x":9,"y":8274},{"x":10,"y":7935},{"x":11,"y":12168},{"x":12,"y":11173},{"x":13,"y":10445},{"x":14,"y":10248},{"x":15,"y":7808},{"x":16,"y":7729},{"x":17,"y":8024},{"x":18,"y":12345},{"x":19,"y":9617},{"x":20,"y":8439},{"x":21,"y":8807},{"x":22,"y":7077},{"x":23,"y":7140},{"x":24,"y":8550},{"x":25,"y":9374},{"x":26,"y":9221},{"x":27,"y":11006},{"x":28,"y":9324},{"x":29,"y":7472},{"x":30,"y":10782}]}],"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"c6a82d22-4bd3-4c92-bb61-12d86b5494bd\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"c6a82d22-4bd3-4c92-bb61-12d86b5494bd\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"c6a82d22-4bd3-4c92-bb61-12d86b5494bd\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"c6a82d22-4bd3-4c92-bb61-12d86b5494bd\", :values ({:x 0, :y 8774} {:x 1, :y 6783} {:x 2, :y 9144} {:x 3, :y 9718} {:x 4, :y 9909} {:x 5, :y 11237} {:x 6, :y 10819} {:x 7, :y 9143} {:x 8, :y 6782} {:x 9, :y 8274} {:x 10, :y 7935} {:x 11, :y 12168} {:x 12, :y 11173} {:x 13, :y 10445} {:x 14, :y 10248} {:x 15, :y 7808} {:x 16, :y 7729} {:x 17, :y 8024} {:x 18, :y 12345} {:x 19, :y 9617} {:x 20, :y 8439} {:x 21, :y 8807} {:x 22, :y 7077} {:x 23, :y 7140} {:x 24, :y 8550} {:x 25, :y 9374} {:x 26, :y 9221} {:x 27, :y 11006} {:x 28, :y 9324} {:x 29, :y 7472} {:x 30, :y 10782})}], :width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; **
;;; ### Daily Newspapers 1
;;; Daily tweet counts of SZ, FAZ and Bild.
;; **

;; @@
(let [sz-counts (map #(mc/count @db "tweets" {:user.screen_name "SZ" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      faz-counts (map #(mc/count @db "tweets" {:user.screen_name "FAZ_NET" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
       bild-counts (map #(mc/count @db "tweets" {:user.screen_name "BILD" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)]
    (plot/compose
      (plot/list-plot sz-counts :joined true :color "red" :plot-size 900 :plot-range [[0 30] [0 140]])
      (plot/list-plot faz-counts :joined true :color "green")
      (plot/list-plot bild-counts :joined true :color "blue")))
;; @@
;; =>
;;; {"type":"vega","content":{"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":[0,30]},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":[0,140]}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"51a97545-5b50-4307-a421-48f914663301","values":[{"x":0,"y":62},{"x":1,"y":40},{"x":2,"y":35},{"x":3,"y":53},{"x":4,"y":66},{"x":5,"y":76},{"x":6,"y":65},{"x":7,"y":78},{"x":8,"y":42},{"x":9,"y":40},{"x":10,"y":71},{"x":11,"y":63},{"x":12,"y":46},{"x":13,"y":55},{"x":14,"y":65},{"x":15,"y":36},{"x":16,"y":46},{"x":17,"y":34},{"x":18,"y":35},{"x":19,"y":58},{"x":20,"y":71},{"x":21,"y":58},{"x":22,"y":2},{"x":23,"y":0},{"x":24,"y":78},{"x":25,"y":73},{"x":26,"y":73},{"x":27,"y":72},{"x":28,"y":41},{"x":29,"y":46},{"x":30,"y":35}]},{"name":"c3cea8c6-01a5-452b-8299-d4c5fda02f5b","values":[{"x":0,"y":118},{"x":1,"y":61},{"x":2,"y":66},{"x":3,"y":95},{"x":4,"y":96},{"x":5,"y":97},{"x":6,"y":102},{"x":7,"y":93},{"x":8,"y":68},{"x":9,"y":67},{"x":10,"y":92},{"x":11,"y":110},{"x":12,"y":108},{"x":13,"y":110},{"x":14,"y":100},{"x":15,"y":69},{"x":16,"y":73},{"x":17,"y":89},{"x":18,"y":105},{"x":19,"y":104},{"x":20,"y":112},{"x":21,"y":108},{"x":22,"y":74},{"x":23,"y":70},{"x":24,"y":101},{"x":25,"y":113},{"x":26,"y":117},{"x":27,"y":122},{"x":28,"y":117},{"x":29,"y":78},{"x":30,"y":84}]},{"name":"68c05a40-e3aa-493c-8ded-812115c5d53b","values":[{"x":0,"y":50},{"x":1,"y":21},{"x":2,"y":30},{"x":3,"y":41},{"x":4,"y":49},{"x":5,"y":48},{"x":6,"y":45},{"x":7,"y":44},{"x":8,"y":38},{"x":9,"y":35},{"x":10,"y":42},{"x":11,"y":50},{"x":12,"y":55},{"x":13,"y":50},{"x":14,"y":35},{"x":15,"y":38},{"x":16,"y":23},{"x":17,"y":37},{"x":18,"y":50},{"x":19,"y":44},{"x":20,"y":48},{"x":21,"y":51},{"x":22,"y":44},{"x":23,"y":58},{"x":24,"y":45},{"x":25,"y":53},{"x":26,"y":49},{"x":27,"y":47},{"x":28,"y":37},{"x":29,"y":43},{"x":30,"y":27}]}],"marks":[{"type":"line","from":{"data":"51a97545-5b50-4307-a421-48f914663301"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"red"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"c3cea8c6-01a5-452b-8299-d4c5fda02f5b"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"green"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"68c05a40-e3aa-493c-8ded-812115c5d53b"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"blue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [0 30]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain [0 140]}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"51a97545-5b50-4307-a421-48f914663301\", :values ({:x 0, :y 62} {:x 1, :y 40} {:x 2, :y 35} {:x 3, :y 53} {:x 4, :y 66} {:x 5, :y 76} {:x 6, :y 65} {:x 7, :y 78} {:x 8, :y 42} {:x 9, :y 40} {:x 10, :y 71} {:x 11, :y 63} {:x 12, :y 46} {:x 13, :y 55} {:x 14, :y 65} {:x 15, :y 36} {:x 16, :y 46} {:x 17, :y 34} {:x 18, :y 35} {:x 19, :y 58} {:x 20, :y 71} {:x 21, :y 58} {:x 22, :y 2} {:x 23, :y 0} {:x 24, :y 78} {:x 25, :y 73} {:x 26, :y 73} {:x 27, :y 72} {:x 28, :y 41} {:x 29, :y 46} {:x 30, :y 35})} {:name \"c3cea8c6-01a5-452b-8299-d4c5fda02f5b\", :values ({:x 0, :y 118} {:x 1, :y 61} {:x 2, :y 66} {:x 3, :y 95} {:x 4, :y 96} {:x 5, :y 97} {:x 6, :y 102} {:x 7, :y 93} {:x 8, :y 68} {:x 9, :y 67} {:x 10, :y 92} {:x 11, :y 110} {:x 12, :y 108} {:x 13, :y 110} {:x 14, :y 100} {:x 15, :y 69} {:x 16, :y 73} {:x 17, :y 89} {:x 18, :y 105} {:x 19, :y 104} {:x 20, :y 112} {:x 21, :y 108} {:x 22, :y 74} {:x 23, :y 70} {:x 24, :y 101} {:x 25, :y 113} {:x 26, :y 117} {:x 27, :y 122} {:x 28, :y 117} {:x 29, :y 78} {:x 30, :y 84})} {:name \"68c05a40-e3aa-493c-8ded-812115c5d53b\", :values ({:x 0, :y 50} {:x 1, :y 21} {:x 2, :y 30} {:x 3, :y 41} {:x 4, :y 49} {:x 5, :y 48} {:x 6, :y 45} {:x 7, :y 44} {:x 8, :y 38} {:x 9, :y 35} {:x 10, :y 42} {:x 11, :y 50} {:x 12, :y 55} {:x 13, :y 50} {:x 14, :y 35} {:x 15, :y 38} {:x 16, :y 23} {:x 17, :y 37} {:x 18, :y 50} {:x 19, :y 44} {:x 20, :y 48} {:x 21, :y 51} {:x 22, :y 44} {:x 23, :y 58} {:x 24, :y 45} {:x 25, :y 53} {:x 26, :y 49} {:x 27, :y 47} {:x 28, :y 37} {:x 29, :y 43} {:x 30, :y 27})}), :marks ({:type \"line\", :from {:data \"51a97545-5b50-4307-a421-48f914663301\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"red\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"c3cea8c6-01a5-452b-8299-d4c5fda02f5b\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"green\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"68c05a40-e3aa-493c-8ded-812115c5d53b\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"blue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; **
;;; ### Daily Newspaper 2
;;; Daily tweet counts of Welt, Westen and taz.
;; **

;; @@
(let [welt-counts (map #(mc/count @db "tweets" {:user.screen_name "welt" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      taz-counts (map #(mc/count @db "tweets" {:user.screen_name "tazgezwitscher" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      westen-counts (map #(mc/count @db "tweets" {:user.screen_name "DerWesten" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)]
  (plot/compose
      (plot/list-plot welt-counts :joined true :color "red" :plot-size 900 :plot-range [[0 30] [0 140]])
      (plot/list-plot taz-counts :joined true :color "green")
      (plot/list-plot westen-counts :joined true :color "blue")))
;; @@
;; =>
;;; {"type":"vega","content":{"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":[0,30]},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":[0,140]}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"480cf0e2-11b1-42cd-a42e-8b9d23b8be32","values":[{"x":0,"y":52},{"x":1,"y":42},{"x":2,"y":57},{"x":3,"y":60},{"x":4,"y":66},{"x":5,"y":61},{"x":6,"y":77},{"x":7,"y":75},{"x":8,"y":56},{"x":9,"y":60},{"x":10,"y":51},{"x":11,"y":67},{"x":12,"y":73},{"x":13,"y":82},{"x":14,"y":68},{"x":15,"y":32},{"x":16,"y":59},{"x":17,"y":69},{"x":18,"y":92},{"x":19,"y":74},{"x":20,"y":73},{"x":21,"y":51},{"x":22,"y":68},{"x":23,"y":63},{"x":24,"y":69},{"x":25,"y":69},{"x":26,"y":63},{"x":27,"y":79},{"x":28,"y":68},{"x":29,"y":55},{"x":30,"y":59}]},{"name":"9b1a5002-100b-4a23-b57d-371d658575a7","values":[{"x":0,"y":22},{"x":1,"y":15},{"x":2,"y":12},{"x":3,"y":22},{"x":4,"y":22},{"x":5,"y":23},{"x":6,"y":30},{"x":7,"y":19},{"x":8,"y":15},{"x":9,"y":16},{"x":10,"y":17},{"x":11,"y":25},{"x":12,"y":21},{"x":13,"y":25},{"x":14,"y":31},{"x":15,"y":14},{"x":16,"y":15},{"x":17,"y":20},{"x":18,"y":32},{"x":19,"y":27},{"x":20,"y":40},{"x":21,"y":29},{"x":22,"y":16},{"x":23,"y":18},{"x":24,"y":24},{"x":25,"y":31},{"x":26,"y":27},{"x":27,"y":37},{"x":28,"y":25},{"x":29,"y":3},{"x":30,"y":27}]},{"name":"1fc1967c-bfdd-4890-9fcd-b33ba19dd159","values":[{"x":0,"y":41},{"x":1,"y":16},{"x":2,"y":21},{"x":3,"y":31},{"x":4,"y":34},{"x":5,"y":33},{"x":6,"y":31},{"x":7,"y":29},{"x":8,"y":12},{"x":9,"y":17},{"x":10,"y":32},{"x":11,"y":31},{"x":12,"y":32},{"x":13,"y":52},{"x":14,"y":37},{"x":15,"y":13},{"x":16,"y":17},{"x":17,"y":35},{"x":18,"y":31},{"x":19,"y":32},{"x":20,"y":36},{"x":21,"y":49},{"x":22,"y":26},{"x":23,"y":27},{"x":24,"y":31},{"x":25,"y":31},{"x":26,"y":29},{"x":27,"y":48},{"x":28,"y":48},{"x":29,"y":24},{"x":30,"y":21}]}],"marks":[{"type":"line","from":{"data":"480cf0e2-11b1-42cd-a42e-8b9d23b8be32"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"red"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"9b1a5002-100b-4a23-b57d-371d658575a7"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"green"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"1fc1967c-bfdd-4890-9fcd-b33ba19dd159"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"blue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [0 30]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain [0 140]}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"480cf0e2-11b1-42cd-a42e-8b9d23b8be32\", :values ({:x 0, :y 52} {:x 1, :y 42} {:x 2, :y 57} {:x 3, :y 60} {:x 4, :y 66} {:x 5, :y 61} {:x 6, :y 77} {:x 7, :y 75} {:x 8, :y 56} {:x 9, :y 60} {:x 10, :y 51} {:x 11, :y 67} {:x 12, :y 73} {:x 13, :y 82} {:x 14, :y 68} {:x 15, :y 32} {:x 16, :y 59} {:x 17, :y 69} {:x 18, :y 92} {:x 19, :y 74} {:x 20, :y 73} {:x 21, :y 51} {:x 22, :y 68} {:x 23, :y 63} {:x 24, :y 69} {:x 25, :y 69} {:x 26, :y 63} {:x 27, :y 79} {:x 28, :y 68} {:x 29, :y 55} {:x 30, :y 59})} {:name \"9b1a5002-100b-4a23-b57d-371d658575a7\", :values ({:x 0, :y 22} {:x 1, :y 15} {:x 2, :y 12} {:x 3, :y 22} {:x 4, :y 22} {:x 5, :y 23} {:x 6, :y 30} {:x 7, :y 19} {:x 8, :y 15} {:x 9, :y 16} {:x 10, :y 17} {:x 11, :y 25} {:x 12, :y 21} {:x 13, :y 25} {:x 14, :y 31} {:x 15, :y 14} {:x 16, :y 15} {:x 17, :y 20} {:x 18, :y 32} {:x 19, :y 27} {:x 20, :y 40} {:x 21, :y 29} {:x 22, :y 16} {:x 23, :y 18} {:x 24, :y 24} {:x 25, :y 31} {:x 26, :y 27} {:x 27, :y 37} {:x 28, :y 25} {:x 29, :y 3} {:x 30, :y 27})} {:name \"1fc1967c-bfdd-4890-9fcd-b33ba19dd159\", :values ({:x 0, :y 41} {:x 1, :y 16} {:x 2, :y 21} {:x 3, :y 31} {:x 4, :y 34} {:x 5, :y 33} {:x 6, :y 31} {:x 7, :y 29} {:x 8, :y 12} {:x 9, :y 17} {:x 10, :y 32} {:x 11, :y 31} {:x 12, :y 32} {:x 13, :y 52} {:x 14, :y 37} {:x 15, :y 13} {:x 16, :y 17} {:x 17, :y 35} {:x 18, :y 31} {:x 19, :y 32} {:x 20, :y 36} {:x 21, :y 49} {:x 22, :y 26} {:x 23, :y 27} {:x 24, :y 31} {:x 25, :y 31} {:x 26, :y 29} {:x 27, :y 48} {:x 28, :y 48} {:x 29, :y 24} {:x 30, :y 21})}), :marks ({:type \"line\", :from {:data \"480cf0e2-11b1-42cd-a42e-8b9d23b8be32\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"red\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"9b1a5002-100b-4a23-b57d-371d658575a7\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"green\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"1fc1967c-bfdd-4890-9fcd-b33ba19dd159\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"blue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; **
;;; ### Weekly Newsmagazines
;;; Daily tweet counts of Spiegel, Stern and Focus.
;; **

;; @@
(let [spon-counts (map #(mc/count @db "tweets" {:user.screen_name "SPIEGELONLINE" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      stern-counts (map #(mc/count @db "tweets" {:user.screen_name "sternde" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      focus-counts (map #(mc/count @db "tweets" {:user.screen_name "focusonline" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)]
  (plot/compose
    (plot/list-plot spon-counts :joined true :color "red" :plot-size 900 :plot-range [[0 30] [0 130]])
    (plot/list-plot stern-counts :joined true :color "green")
    (plot/list-plot focus-counts :joined true :color "blue")))
;; @@
;; =>
;;; {"type":"vega","content":{"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":[0,30]},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":[0,130]}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"35f84ed3-298e-4a3b-80ed-bbd7db499123","values":[{"x":0,"y":66},{"x":1,"y":43},{"x":2,"y":53},{"x":3,"y":61},{"x":4,"y":50},{"x":5,"y":69},{"x":6,"y":60},{"x":7,"y":50},{"x":8,"y":44},{"x":9,"y":37},{"x":10,"y":49},{"x":11,"y":62},{"x":12,"y":68},{"x":13,"y":58},{"x":14,"y":61},{"x":15,"y":53},{"x":16,"y":42},{"x":17,"y":54},{"x":18,"y":59},{"x":19,"y":42},{"x":20,"y":56},{"x":21,"y":55},{"x":22,"y":55},{"x":23,"y":56},{"x":24,"y":50},{"x":25,"y":62},{"x":26,"y":54},{"x":27,"y":60},{"x":28,"y":82},{"x":29,"y":70},{"x":30,"y":82}]},{"name":"6920f0c2-c886-423d-9a59-ef316027b1ba","values":[{"x":0,"y":24},{"x":1,"y":17},{"x":2,"y":30},{"x":3,"y":46},{"x":4,"y":39},{"x":5,"y":43},{"x":6,"y":46},{"x":7,"y":36},{"x":8,"y":20},{"x":9,"y":11},{"x":10,"y":32},{"x":11,"y":34},{"x":12,"y":36},{"x":13,"y":27},{"x":14,"y":28},{"x":15,"y":26},{"x":16,"y":23},{"x":17,"y":39},{"x":18,"y":42},{"x":19,"y":31},{"x":20,"y":26},{"x":21,"y":25},{"x":22,"y":17},{"x":23,"y":15},{"x":24,"y":40},{"x":25,"y":37},{"x":26,"y":41},{"x":27,"y":40},{"x":28,"y":32},{"x":29,"y":43},{"x":30,"y":36}]},{"name":"5bd3fe84-c67f-4660-a71f-44f0ba485cf5","values":[{"x":0,"y":8},{"x":1,"y":2},{"x":2,"y":6},{"x":3,"y":6},{"x":4,"y":8},{"x":5,"y":9},{"x":6,"y":9},{"x":7,"y":12},{"x":8,"y":4},{"x":9,"y":8},{"x":10,"y":7},{"x":11,"y":13},{"x":12,"y":9},{"x":13,"y":9},{"x":14,"y":9},{"x":15,"y":4},{"x":16,"y":10},{"x":17,"y":10},{"x":18,"y":15},{"x":19,"y":12},{"x":20,"y":8},{"x":21,"y":9},{"x":22,"y":8},{"x":23,"y":7},{"x":24,"y":17},{"x":25,"y":10},{"x":26,"y":9},{"x":27,"y":7},{"x":28,"y":6},{"x":29,"y":12},{"x":30,"y":8}]}],"marks":[{"type":"line","from":{"data":"35f84ed3-298e-4a3b-80ed-bbd7db499123"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"red"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"6920f0c2-c886-423d-9a59-ef316027b1ba"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"green"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"5bd3fe84-c67f-4660-a71f-44f0ba485cf5"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"blue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [0 30]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain [0 130]}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"35f84ed3-298e-4a3b-80ed-bbd7db499123\", :values ({:x 0, :y 66} {:x 1, :y 43} {:x 2, :y 53} {:x 3, :y 61} {:x 4, :y 50} {:x 5, :y 69} {:x 6, :y 60} {:x 7, :y 50} {:x 8, :y 44} {:x 9, :y 37} {:x 10, :y 49} {:x 11, :y 62} {:x 12, :y 68} {:x 13, :y 58} {:x 14, :y 61} {:x 15, :y 53} {:x 16, :y 42} {:x 17, :y 54} {:x 18, :y 59} {:x 19, :y 42} {:x 20, :y 56} {:x 21, :y 55} {:x 22, :y 55} {:x 23, :y 56} {:x 24, :y 50} {:x 25, :y 62} {:x 26, :y 54} {:x 27, :y 60} {:x 28, :y 82} {:x 29, :y 70} {:x 30, :y 82})} {:name \"6920f0c2-c886-423d-9a59-ef316027b1ba\", :values ({:x 0, :y 24} {:x 1, :y 17} {:x 2, :y 30} {:x 3, :y 46} {:x 4, :y 39} {:x 5, :y 43} {:x 6, :y 46} {:x 7, :y 36} {:x 8, :y 20} {:x 9, :y 11} {:x 10, :y 32} {:x 11, :y 34} {:x 12, :y 36} {:x 13, :y 27} {:x 14, :y 28} {:x 15, :y 26} {:x 16, :y 23} {:x 17, :y 39} {:x 18, :y 42} {:x 19, :y 31} {:x 20, :y 26} {:x 21, :y 25} {:x 22, :y 17} {:x 23, :y 15} {:x 24, :y 40} {:x 25, :y 37} {:x 26, :y 41} {:x 27, :y 40} {:x 28, :y 32} {:x 29, :y 43} {:x 30, :y 36})} {:name \"5bd3fe84-c67f-4660-a71f-44f0ba485cf5\", :values ({:x 0, :y 8} {:x 1, :y 2} {:x 2, :y 6} {:x 3, :y 6} {:x 4, :y 8} {:x 5, :y 9} {:x 6, :y 9} {:x 7, :y 12} {:x 8, :y 4} {:x 9, :y 8} {:x 10, :y 7} {:x 11, :y 13} {:x 12, :y 9} {:x 13, :y 9} {:x 14, :y 9} {:x 15, :y 4} {:x 16, :y 10} {:x 17, :y 10} {:x 18, :y 15} {:x 19, :y 12} {:x 20, :y 8} {:x 21, :y 9} {:x 22, :y 8} {:x 23, :y 7} {:x 24, :y 17} {:x 25, :y 10} {:x 26, :y 9} {:x 27, :y 7} {:x 28, :y 6} {:x 29, :y 12} {:x 30, :y 8})}), :marks ({:type \"line\", :from {:data \"35f84ed3-298e-4a3b-80ed-bbd7db499123\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"red\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"6920f0c2-c886-423d-9a59-ef316027b1ba\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"green\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"5bd3fe84-c67f-4660-a71f-44f0ba485cf5\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"blue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; **
;;; ### TV News
;; **

;; @@
(let [tagesschau-counts (map #(mc/count @db "tweets" {:user.screen_name "tagesschau" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      zdf-counts (map #(mc/count @db "tweets" {:user.screen_name "ZDFheute" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      n24-counts (map #(mc/count @db "tweets" {:user.screen_name "N24_de" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)
      ntv-counts (map #(mc/count @db "tweets" {:user.screen_name "ntvde" :created_at {$gte % $lt (t/plus % (t/days 1))}}) dates)]
  (plot/compose
    (plot/list-plot tagesschau-counts :joined true :color "red" :plot-size 1000 :plot-range [[0 30] [0 210]])
    (plot/list-plot zdf-counts :joined true :color "green")
    (plot/list-plot n24-counts :joined true :color "orange")
    (plot/list-plot ntv-counts :joined true :color "blue")))
;; @@
;; =>
;;; {"type":"vega","content":{"width":1000,"height":618.0469970703125,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":[0,30]},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":[0,210]}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"da5b4b29-4b01-4e60-bd31-af293dfd84ee","values":[{"x":0,"y":84},{"x":1,"y":32},{"x":2,"y":42},{"x":3,"y":52},{"x":4,"y":73},{"x":5,"y":66},{"x":6,"y":47},{"x":7,"y":66},{"x":8,"y":41},{"x":9,"y":42},{"x":10,"y":45},{"x":11,"y":56},{"x":12,"y":47},{"x":13,"y":61},{"x":14,"y":74},{"x":15,"y":39},{"x":16,"y":21},{"x":17,"y":59},{"x":18,"y":71},{"x":19,"y":65},{"x":20,"y":68},{"x":21,"y":53},{"x":22,"y":36},{"x":23,"y":28},{"x":24,"y":54},{"x":25,"y":66},{"x":26,"y":50},{"x":27,"y":91},{"x":28,"y":52},{"x":29,"y":32},{"x":30,"y":123}]},{"name":"d58a13c0-0b7a-4488-a2f0-8700e52c0802","values":[{"x":0,"y":33},{"x":1,"y":27},{"x":2,"y":24},{"x":3,"y":42},{"x":4,"y":32},{"x":5,"y":26},{"x":6,"y":28},{"x":7,"y":37},{"x":8,"y":21},{"x":9,"y":18},{"x":10,"y":30},{"x":11,"y":31},{"x":12,"y":45},{"x":13,"y":40},{"x":14,"y":28},{"x":15,"y":30},{"x":16,"y":31},{"x":17,"y":25},{"x":18,"y":45},{"x":19,"y":37},{"x":20,"y":29},{"x":21,"y":26},{"x":22,"y":17},{"x":23,"y":17},{"x":24,"y":26},{"x":25,"y":50},{"x":26,"y":27},{"x":27,"y":24},{"x":28,"y":33},{"x":29,"y":14},{"x":30,"y":56}]},{"name":"d0ee2b2c-e64b-47e0-8d90-40ea71dc5d1e","values":[{"x":0,"y":87},{"x":1,"y":50},{"x":2,"y":56},{"x":3,"y":75},{"x":4,"y":67},{"x":5,"y":83},{"x":6,"y":72},{"x":7,"y":58},{"x":8,"y":43},{"x":9,"y":53},{"x":10,"y":58},{"x":11,"y":65},{"x":12,"y":65},{"x":13,"y":61},{"x":14,"y":75},{"x":15,"y":53},{"x":16,"y":49},{"x":17,"y":60},{"x":18,"y":76},{"x":19,"y":74},{"x":20,"y":63},{"x":21,"y":77},{"x":22,"y":47},{"x":23,"y":46},{"x":24,"y":68},{"x":25,"y":73},{"x":26,"y":69},{"x":27,"y":73},{"x":28,"y":61},{"x":29,"y":48},{"x":30,"y":57}]},{"name":"bc53801a-623f-4018-8cc1-7ed595eaf593","values":[{"x":0,"y":49},{"x":1,"y":43},{"x":2,"y":43},{"x":3,"y":43},{"x":4,"y":50},{"x":5,"y":42},{"x":6,"y":44},{"x":7,"y":46},{"x":8,"y":34},{"x":9,"y":41},{"x":10,"y":47},{"x":11,"y":48},{"x":12,"y":68},{"x":13,"y":113},{"x":14,"y":114},{"x":15,"y":49},{"x":16,"y":28},{"x":17,"y":50},{"x":18,"y":62},{"x":19,"y":63},{"x":20,"y":61},{"x":21,"y":75},{"x":22,"y":70},{"x":23,"y":57},{"x":24,"y":72},{"x":25,"y":73},{"x":26,"y":66},{"x":27,"y":77},{"x":28,"y":67},{"x":29,"y":62},{"x":30,"y":59}]}],"marks":[{"type":"line","from":{"data":"da5b4b29-4b01-4e60-bd31-af293dfd84ee"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"red"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"d58a13c0-0b7a-4488-a2f0-8700e52c0802"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"green"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"d0ee2b2c-e64b-47e0-8d90-40ea71dc5d1e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"orange"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"bc53801a-623f-4018-8cc1-7ed595eaf593"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"blue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 1000, :height 618.047, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain [0 30]} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain [0 210]}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"da5b4b29-4b01-4e60-bd31-af293dfd84ee\", :values ({:x 0, :y 84} {:x 1, :y 32} {:x 2, :y 42} {:x 3, :y 52} {:x 4, :y 73} {:x 5, :y 66} {:x 6, :y 47} {:x 7, :y 66} {:x 8, :y 41} {:x 9, :y 42} {:x 10, :y 45} {:x 11, :y 56} {:x 12, :y 47} {:x 13, :y 61} {:x 14, :y 74} {:x 15, :y 39} {:x 16, :y 21} {:x 17, :y 59} {:x 18, :y 71} {:x 19, :y 65} {:x 20, :y 68} {:x 21, :y 53} {:x 22, :y 36} {:x 23, :y 28} {:x 24, :y 54} {:x 25, :y 66} {:x 26, :y 50} {:x 27, :y 91} {:x 28, :y 52} {:x 29, :y 32} {:x 30, :y 123})} {:name \"d58a13c0-0b7a-4488-a2f0-8700e52c0802\", :values ({:x 0, :y 33} {:x 1, :y 27} {:x 2, :y 24} {:x 3, :y 42} {:x 4, :y 32} {:x 5, :y 26} {:x 6, :y 28} {:x 7, :y 37} {:x 8, :y 21} {:x 9, :y 18} {:x 10, :y 30} {:x 11, :y 31} {:x 12, :y 45} {:x 13, :y 40} {:x 14, :y 28} {:x 15, :y 30} {:x 16, :y 31} {:x 17, :y 25} {:x 18, :y 45} {:x 19, :y 37} {:x 20, :y 29} {:x 21, :y 26} {:x 22, :y 17} {:x 23, :y 17} {:x 24, :y 26} {:x 25, :y 50} {:x 26, :y 27} {:x 27, :y 24} {:x 28, :y 33} {:x 29, :y 14} {:x 30, :y 56})} {:name \"d0ee2b2c-e64b-47e0-8d90-40ea71dc5d1e\", :values ({:x 0, :y 87} {:x 1, :y 50} {:x 2, :y 56} {:x 3, :y 75} {:x 4, :y 67} {:x 5, :y 83} {:x 6, :y 72} {:x 7, :y 58} {:x 8, :y 43} {:x 9, :y 53} {:x 10, :y 58} {:x 11, :y 65} {:x 12, :y 65} {:x 13, :y 61} {:x 14, :y 75} {:x 15, :y 53} {:x 16, :y 49} {:x 17, :y 60} {:x 18, :y 76} {:x 19, :y 74} {:x 20, :y 63} {:x 21, :y 77} {:x 22, :y 47} {:x 23, :y 46} {:x 24, :y 68} {:x 25, :y 73} {:x 26, :y 69} {:x 27, :y 73} {:x 28, :y 61} {:x 29, :y 48} {:x 30, :y 57})} {:name \"bc53801a-623f-4018-8cc1-7ed595eaf593\", :values ({:x 0, :y 49} {:x 1, :y 43} {:x 2, :y 43} {:x 3, :y 43} {:x 4, :y 50} {:x 5, :y 42} {:x 6, :y 44} {:x 7, :y 46} {:x 8, :y 34} {:x 9, :y 41} {:x 10, :y 47} {:x 11, :y 48} {:x 12, :y 68} {:x 13, :y 113} {:x 14, :y 114} {:x 15, :y 49} {:x 16, :y 28} {:x 17, :y 50} {:x 18, :y 62} {:x 19, :y 63} {:x 20, :y 61} {:x 21, :y 75} {:x 22, :y 70} {:x 23, :y 57} {:x 24, :y 72} {:x 25, :y 73} {:x 26, :y 66} {:x 27, :y 77} {:x 28, :y 67} {:x 29, :y 62} {:x 30, :y 59})}), :marks ({:type \"line\", :from {:data \"da5b4b29-4b01-4e60-bd31-af293dfd84ee\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"red\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"d58a13c0-0b7a-4488-a2f0-8700e52c0802\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"green\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"d0ee2b2c-e64b-47e0-8d90-40ea71dc5d1e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"orange\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"bc53801a-623f-4018-8cc1-7ed595eaf593\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"blue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; **
;;; ## Average Tweets per Hour
;; **

;; @@
(let [days-running (t/in-hours (t/interval start-date end-date))
        dates (take days-running (p/periodic-seq start-date (t/hours 1)))
        tweet-count (map #(mc/count @db "tweets" {:created_at {$gte % $lt (t/plus % (t/hours 1))}}) dates)
        times (range days-running)
        tweet-count-2 (loop [hours-list []
                             tweet-dist tweet-count]
                        (if (empty? tweet-dist)
                          hours-list
                          (recur (conj hours-list (vec (take 24 tweet-dist))) (drop 24 tweet-dist))))
        avg-tweets-per-hour (map (fn [hour] (/ (reduce + (map (fn [count] (get count hour)) tweet-count-2)) (count tweet-count-2))) (range 24))]
  (plot/list-plot avg-tweets-per-hour :joined true :plot-size 900))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a","values":[{"x":0,"y":77.16129032258065},{"x":1,"y":51.80645161290323},{"x":2,"y":49.19354838709677},{"x":3,"y":59.48387096774194},{"x":4,"y":108.258064516129},{"x":5,"y":236},{"x":6,"y":431.1290322580645},{"x":7,"y":554.0322580645161},{"x":8,"y":572.1290322580645},{"x":9,"y":597.9677419354839},{"x":10,"y":605.3870967741935},{"x":11,"y":592.0322580645161},{"x":12,"y":605.2258064516129},{"x":13,"y":565.4193548387098},{"x":14,"y":519.8064516129032},{"x":15,"y":546.1935483870968},{"x":16,"y":549.8064516129032},{"x":17,"y":513.2258064516129},{"x":18,"y":461.8387096774194},{"x":19,"y":444.741935483871},{"x":20,"y":425.8387096774194},{"x":21,"y":313.4193548387097},{"x":22,"y":202.2258064516129},{"x":23,"y":119.8387096774194}]}],"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"a6c39e1c-a4a5-4206-9c54-e5cbf7c45f0a\", :values ({:x 0, :y 2392/31} {:x 1, :y 1606/31} {:x 2, :y 1525/31} {:x 3, :y 1844/31} {:x 4, :y 3356/31} {:x 5, :y 236} {:x 6, :y 13365/31} {:x 7, :y 17175/31} {:x 8, :y 17736/31} {:x 9, :y 18537/31} {:x 10, :y 18767/31} {:x 11, :y 18353/31} {:x 12, :y 18762/31} {:x 13, :y 17528/31} {:x 14, :y 16114/31} {:x 15, :y 16932/31} {:x 16, :y 17044/31} {:x 17, :y 15910/31} {:x 18, :y 14317/31} {:x 19, :y 13787/31} {:x 20, :y 13201/31} {:x 21, :y 9716/31} {:x 22, :y 6269/31} {:x 23, :y 3715/31})}], :width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; @@
(let [news-tweets (mc/count @db "tweets" {:user.screen_name {$in news-accounts}
                                          :created_at {$gt start-date
                                                       $lt end-date}})
      overall (mc/count @db "tweets" {:created_at {$gt start-date
                                                       $lt end-date}})]
  (float (/ news-tweets overall)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>0.06834649</span>","value":"0.06834649"}
;; <=

;; **
;;; ## Graph Analysis
;;; In the following section the individual graphs and subgraphs are examined. First basic metrics such as degree, depth and average connectivity are computed.
;;; 
;;; An example of an individual tree is as follows:
;; **

;; @@
(def some-tree (build-tree-from-source (ObjectId. "53f33d9ee4b0c2a12eb4a339")))

;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/some-tree</span>","value":"#'unsightly-reserve/some-tree"}
;; <=

;; **
;;; Basic Analysis has following features
;; **

;; @@
(:title some-tree)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;Ferguson : Der Tag, an dem die US-Polizei mein Feind wurde - Nachrichten Politik - Ausland - DIE WELT&quot;</span>","value":"\"Ferguson : Der Tag, an dem die US-Polizei mein Feind wurde - Nachrichten Politik - Ausland - DIE WELT\""}
;; <=

;; @@
(-> some-tree :analysis keys)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>(:size :height :users :pub-times :hashtags :delays)</span>","value":"(:size :height :users :pub-times :hashtags :delays)"}
;; <=

;; **
;;; ### Basic Tree Metrics
;; **

;; @@
(-> some-tree :analysis (dissoc :pub-times :hashtags :delays :users))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:size</span>","value":":size"},{"type":"html","content":"<span class='clj-long'>479</span>","value":"479"}],"value":"[:size 479]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:height</span>","value":":height"},{"type":"html","content":"<span class='clj-long'>5</span>","value":"5"}],"value":"[:height 5]"}],"value":"{:size 479, :height 5}"}
;; <=

;; **
;;; ### Hashtag Distribution
;;; Top 10 hashtags.
;; **

;; @@
(let [hashtags (-> some-tree :analysis :hashtags)]
  (if (empty? hashtags)
    "No hashtags"
    (let [h-freq (->> hashtags frequencies (sort-by second >) (take 10))]
  [(into #{} hashtags)
   (plot/bar-chart (keys h-freq) (vals h-freq) :plot-size 800)])))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-set'>#{</span>","close":"<span class='clj-set'>}</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;pressefreiheit&quot;</span>","value":"\"pressefreiheit\""},{"type":"html","content":"<span class='clj-string'>&quot;us&quot;</span>","value":"\"us\""},{"type":"html","content":"<span class='clj-string'>&quot;imgeilstenlandderwelt&quot;</span>","value":"\"imgeilstenlandderwelt\""},{"type":"html","content":"<span class='clj-string'>&quot;polizei&quot;</span>","value":"\"polizei\""},{"type":"html","content":"<span class='clj-string'>&quot;springer&quot;</span>","value":"\"springer\""},{"type":"html","content":"<span class='clj-string'>&quot;furgeson&quot;</span>","value":"\"furgeson\""},{"type":"html","content":"<span class='clj-string'>&quot;usa&quot;</span>","value":"\"usa\""},{"type":"html","content":"<span class='clj-string'>&quot;s21&quot;</span>","value":"\"s21\""},{"type":"html","content":"<span class='clj-string'>&quot;graw&quot;</span>","value":"\"graw\""},{"type":"html","content":"<span class='clj-string'>&quot;medien&quot;</span>","value":"\"medien\""},{"type":"html","content":"<span class='clj-string'>&quot;missouri&quot;</span>","value":"\"missouri\""},{"type":"html","content":"<span class='clj-string'>&quot;schland&quot;</span>","value":"\"schland\""},{"type":"html","content":"<span class='clj-string'>&quot;policestate&quot;</span>","value":"\"policestate\""},{"type":"html","content":"<span class='clj-string'>&quot;arbeitsvertrag&quot;</span>","value":"\"arbeitsvertrag\""},{"type":"html","content":"<span class='clj-string'>&quot;firstamendment&quot;</span>","value":"\"firstamendment\""},{"type":"html","content":"<span class='clj-string'>&quot;ferguson&quot;</span>","value":"\"ferguson\""},{"type":"html","content":"<span class='clj-string'>&quot;afd&quot;</span>","value":"\"afd\""},{"type":"html","content":"<span class='clj-string'>&quot;atlantik&quot;</span>","value":"\"atlantik\""}],"value":"#{\"pressefreiheit\" \"us\" \"imgeilstenlandderwelt\" \"polizei\" \"springer\" \"furgeson\" \"usa\" \"s21\" \"graw\" \"medien\" \"missouri\" \"schland\" \"policestate\" \"arbeitsvertrag\" \"firstamendment\" \"ferguson\" \"afd\" \"atlantik\"}"},{"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"ordinal","range":"width","domain":{"data":"d4d74364-fe6f-421c-b8a1-4281749a341b","field":"data.x"}},{"name":"y","range":"height","nice":true,"domain":{"data":"d4d74364-fe6f-421c-b8a1-4281749a341b","field":"data.y"}}],"marks":[{"type":"rect","from":{"data":"d4d74364-fe6f-421c-b8a1-4281749a341b"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"steelblue"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}}],"data":[{"name":"d4d74364-fe6f-421c-b8a1-4281749a341b","values":[{"x":"ferguson","y":124},{"x":"usa","y":5},{"x":"pressefreiheit","y":2},{"x":"us","y":2},{"x":"springer","y":2},{"x":"furgeson","y":2},{"x":"s21","y":2},{"x":"graw","y":2},{"x":"policestate","y":2},{"x":"arbeitsvertrag","y":2}]}],"width":800,"height":494.4375915527344,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"d4d74364-fe6f-421c-b8a1-4281749a341b\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"d4d74364-fe6f-421c-b8a1-4281749a341b\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"d4d74364-fe6f-421c-b8a1-4281749a341b\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"d4d74364-fe6f-421c-b8a1-4281749a341b\", :values ({:x \"ferguson\", :y 124} {:x \"usa\", :y 5} {:x \"pressefreiheit\", :y 2} {:x \"us\", :y 2} {:x \"springer\", :y 2} {:x \"furgeson\", :y 2} {:x \"s21\", :y 2} {:x \"graw\", :y 2} {:x \"policestate\", :y 2} {:x \"arbeitsvertrag\", :y 2})}], :width 800, :height 494.4376, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}],"value":"[#{\"pressefreiheit\" \"us\" \"imgeilstenlandderwelt\" \"polizei\" \"springer\" \"furgeson\" \"usa\" \"s21\" \"graw\" \"medien\" \"missouri\" \"schland\" \"policestate\" \"arbeitsvertrag\" \"firstamendment\" \"ferguson\" \"afd\" \"atlantik\"} #gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"d4d74364-fe6f-421c-b8a1-4281749a341b\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"d4d74364-fe6f-421c-b8a1-4281749a341b\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"d4d74364-fe6f-421c-b8a1-4281749a341b\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"d4d74364-fe6f-421c-b8a1-4281749a341b\", :values ({:x \"ferguson\", :y 124} {:x \"usa\", :y 5} {:x \"pressefreiheit\", :y 2} {:x \"us\", :y 2} {:x \"springer\", :y 2} {:x \"furgeson\", :y 2} {:x \"s21\", :y 2} {:x \"graw\", :y 2} {:x \"policestate\", :y 2} {:x \"arbeitsvertrag\", :y 2})}], :width 800, :height 494.4376, :padding {:bottom 20, :top 10, :right 10, :left 50}}}]"}
;; <=

;; **
;;; ### User Post Distribution
;;; Top 10 Users related to this article.
;; **

;; @@
(let [users (->> some-tree :analysis :users frequencies (sort-by second >) (take 10))]
  (plot/bar-chart (keys users) (vals users) :plot-size 800))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"ordinal","range":"width","domain":{"data":"8e0c572e-7575-4bd8-824a-5ed4636a2343","field":"data.x"}},{"name":"y","range":"height","nice":true,"domain":{"data":"8e0c572e-7575-4bd8-824a-5ed4636a2343","field":"data.y"}}],"marks":[{"type":"rect","from":{"data":"8e0c572e-7575-4bd8-824a-5ed4636a2343"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"steelblue"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}}],"data":[{"name":"8e0c572e-7575-4bd8-824a-5ed4636a2343","values":[{"x":"welt","y":10},{"x":"AufstandS21","y":6},{"x":"olaf26","y":3},{"x":"Welatpiraz","y":3},{"x":"frisch_fish","y":3},{"x":"rapic2012","y":3},{"x":"jep_","y":3},{"x":"Ibicis","y":3},{"x":"thetruemoeckert","y":3},{"x":"LakehillSoccer","y":3}]}],"width":800,"height":494.4375915527344,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"8e0c572e-7575-4bd8-824a-5ed4636a2343\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"8e0c572e-7575-4bd8-824a-5ed4636a2343\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"8e0c572e-7575-4bd8-824a-5ed4636a2343\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"8e0c572e-7575-4bd8-824a-5ed4636a2343\", :values ({:x \"welt\", :y 10} {:x \"AufstandS21\", :y 6} {:x \"olaf26\", :y 3} {:x \"Welatpiraz\", :y 3} {:x \"frisch_fish\", :y 3} {:x \"rapic2012\", :y 3} {:x \"jep_\", :y 3} {:x \"Ibicis\", :y 3} {:x \"thetruemoeckert\", :y 3} {:x \"LakehillSoccer\", :y 3})}], :width 800, :height 494.4376, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; **
;;; ### Delay Distribution
;;; Reaction's delay of an article in minutes.
;; **

;; @@
(let [delays (->> some-tree :analysis :delays (map #(float (/ % 60))))]
  (plot/histogram delays :plot-size 900))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"a2e7b181-1f0c-44d0-912d-e03beb39afae","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"a2e7b181-1f0c-44d0-912d-e03beb39afae","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"a2e7b181-1f0c-44d0-912d-e03beb39afae"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"a2e7b181-1f0c-44d0-912d-e03beb39afae","values":[{"x":0.0,"y":0},{"x":1888.1066406250004,"y":461.0},{"x":3776.213281250001,"y":6.0},{"x":5664.3199218750015,"y":6.0},{"x":7552.426562500002,"y":3.0},{"x":9440.533203125002,"y":0.0},{"x":11328.639843750003,"y":0.0},{"x":13216.746484375004,"y":2.0},{"x":15104.853125000005,"y":0.0},{"x":16992.959765625004,"y":0.0},{"x":18881.066406250004,"y":1.0},{"x":20769.173046875003,"y":0}]}],"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"a2e7b181-1f0c-44d0-912d-e03beb39afae\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"a2e7b181-1f0c-44d0-912d-e03beb39afae\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"a2e7b181-1f0c-44d0-912d-e03beb39afae\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"a2e7b181-1f0c-44d0-912d-e03beb39afae\", :values ({:x 0.0, :y 0} {:x 1888.1066406250004, :y 461.0} {:x 3776.213281250001, :y 6.0} {:x 5664.3199218750015, :y 6.0} {:x 7552.426562500002, :y 3.0} {:x 9440.533203125002, :y 0.0} {:x 11328.639843750003, :y 0.0} {:x 13216.746484375004, :y 2.0} {:x 15104.853125000005, :y 0.0} {:x 16992.959765625004, :y 0.0} {:x 18881.066406250004, :y 1.0} {:x 20769.173046875003, :y 0})}], :width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; **
;;; ### Example Summary
;; **

;; @@
(def dpa-summary (compute-summary "dpa"))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/dpa-summary</span>","value":"#'unsightly-reserve/dpa-summary"}
;; <=

;; @@
(keys dpa-summary)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>(:source :article-count :analytics :total-impact :avg-impact :no-reactions :avg-height)</span>","value":"(:source :article-count :analytics :total-impact :avg-impact :no-reactions :avg-height)"}
;; <=

;; @@
(dissoc dpa-summary :analytics :pub-times)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:source</span>","value":":source"},{"type":"html","content":"<span class='clj-string'>&quot;dpa&quot;</span>","value":"\"dpa\""}],"value":"[:source \"dpa\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:article-count</span>","value":":article-count"},{"type":"html","content":"<span class='clj-unkown'>965</span>","value":"965"}],"value":"[:article-count 965]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:total-impact</span>","value":":total-impact"},{"type":"html","content":"<span class='clj-long'>4811</span>","value":"4811"}],"value":"[:total-impact 4811]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:avg-impact</span>","value":":avg-impact"},{"type":"html","content":"<span class='clj-unkown'>4.985492</span>","value":"4.985492"}],"value":"[:avg-impact 4.985492]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:no-reactions</span>","value":":no-reactions"},{"type":"html","content":"<span class='clj-unkown'>0.19170985</span>","value":"0.19170985"}],"value":"[:no-reactions 0.19170985]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:avg-height</span>","value":":avg-height"},{"type":"html","content":"<span class='clj-unkown'>0.98031086</span>","value":"0.98031086"}],"value":"[:avg-height 0.98031086]"}],"value":"{:source \"dpa\", :article-count 965, :total-impact 4811, :avg-impact 4.985492, :no-reactions 0.19170985, :avg-height 0.98031086}"}
;; <=

;; @@
(-> dpa-summary :analytics first keys)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>(:size :height :users :pub-times :hashtags :delays)</span>","value":"(:size :height :users :pub-times :hashtags :delays)"}
;; <=

;; @@
(let [sizes (->> dpa-summary :analytics (map :size))]
  (plot/histogram sizes :plot-size 900 :bins 100))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"69d6f730-97cd-462b-8ec5-6e1cabd31353","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"69d6f730-97cd-462b-8ec5-6e1cabd31353","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"69d6f730-97cd-462b-8ec5-6e1cabd31353"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"69d6f730-97cd-462b-8ec5-6e1cabd31353","values":[{"x":1.0,"y":0},{"x":1.56,"y":185.0},{"x":2.12,"y":112.0},{"x":2.68,"y":0.0},{"x":3.24,"y":149.0},{"x":3.8000000000000003,"y":0.0},{"x":4.36,"y":112.0},{"x":4.92,"y":0.0},{"x":5.48,"y":101.0},{"x":6.040000000000001,"y":76.0},{"x":6.600000000000001,"y":0.0},{"x":7.160000000000002,"y":48.0},{"x":7.720000000000002,"y":0.0},{"x":8.280000000000003,"y":42.0},{"x":8.840000000000003,"y":0.0},{"x":9.400000000000004,"y":40.0},{"x":9.960000000000004,"y":0.0},{"x":10.520000000000005,"y":24.0},{"x":11.080000000000005,"y":20.0},{"x":11.640000000000006,"y":0.0},{"x":12.200000000000006,"y":7.0},{"x":12.760000000000007,"y":0.0},{"x":13.320000000000007,"y":3.0},{"x":13.880000000000008,"y":0.0},{"x":14.440000000000008,"y":9.0},{"x":15.000000000000009,"y":5.0},{"x":15.56000000000001,"y":0.0},{"x":16.120000000000008,"y":4.0},{"x":16.680000000000007,"y":0.0},{"x":17.240000000000006,"y":3.0},{"x":17.800000000000004,"y":0.0},{"x":18.360000000000003,"y":6.0},{"x":18.92,"y":0.0},{"x":19.48,"y":3.0},{"x":20.04,"y":1.0},{"x":20.599999999999998,"y":0.0},{"x":21.159999999999997,"y":2.0},{"x":21.719999999999995,"y":0.0},{"x":22.279999999999994,"y":2.0},{"x":22.839999999999993,"y":0.0},{"x":23.39999999999999,"y":6.0},{"x":23.95999999999999,"y":0.0},{"x":24.51999999999999,"y":0.0},{"x":25.079999999999988,"y":0.0},{"x":25.639999999999986,"y":0.0},{"x":26.199999999999985,"y":1.0},{"x":26.759999999999984,"y":0.0},{"x":27.319999999999983,"y":1.0},{"x":27.87999999999998,"y":0.0},{"x":28.43999999999998,"y":0.0},{"x":28.99999999999998,"y":0.0},{"x":29.559999999999977,"y":0.0},{"x":30.119999999999976,"y":0.0},{"x":30.679999999999975,"y":0.0},{"x":31.239999999999974,"y":0.0},{"x":31.799999999999972,"y":0.0},{"x":32.35999999999997,"y":0.0},{"x":32.91999999999997,"y":0.0},{"x":33.479999999999976,"y":0.0},{"x":34.03999999999998,"y":0.0},{"x":34.59999999999998,"y":0.0},{"x":35.15999999999998,"y":0.0},{"x":35.719999999999985,"y":0.0},{"x":36.27999999999999,"y":0.0},{"x":36.83999999999999,"y":0.0},{"x":37.39999999999999,"y":0.0},{"x":37.959999999999994,"y":0.0},{"x":38.519999999999996,"y":0.0},{"x":39.08,"y":0.0},{"x":39.64,"y":0.0},{"x":40.2,"y":1.0},{"x":40.760000000000005,"y":0.0},{"x":41.32000000000001,"y":0.0},{"x":41.88000000000001,"y":0.0},{"x":42.44000000000001,"y":0.0},{"x":43.000000000000014,"y":0.0},{"x":43.56000000000002,"y":0.0},{"x":44.12000000000002,"y":0.0},{"x":44.68000000000002,"y":0.0},{"x":45.24000000000002,"y":0.0},{"x":45.800000000000026,"y":0.0},{"x":46.36000000000003,"y":0.0},{"x":46.92000000000003,"y":0.0},{"x":47.48000000000003,"y":0.0},{"x":48.040000000000035,"y":0.0},{"x":48.60000000000004,"y":0.0},{"x":49.16000000000004,"y":0.0},{"x":49.72000000000004,"y":0.0},{"x":50.280000000000044,"y":0.0},{"x":50.840000000000046,"y":0.0},{"x":51.40000000000005,"y":0.0},{"x":51.96000000000005,"y":0.0},{"x":52.52000000000005,"y":0.0},{"x":53.080000000000055,"y":0.0},{"x":53.64000000000006,"y":0.0},{"x":54.20000000000006,"y":0.0},{"x":54.76000000000006,"y":0.0},{"x":55.320000000000064,"y":0.0},{"x":55.88000000000007,"y":0.0},{"x":56.44000000000007,"y":1.0},{"x":57.00000000000007,"y":1.0},{"x":57.56000000000007,"y":0}]}],"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"69d6f730-97cd-462b-8ec5-6e1cabd31353\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"69d6f730-97cd-462b-8ec5-6e1cabd31353\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"69d6f730-97cd-462b-8ec5-6e1cabd31353\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"69d6f730-97cd-462b-8ec5-6e1cabd31353\", :values ({:x 1.0, :y 0} {:x 1.56, :y 185.0} {:x 2.12, :y 112.0} {:x 2.68, :y 0.0} {:x 3.24, :y 149.0} {:x 3.8000000000000003, :y 0.0} {:x 4.36, :y 112.0} {:x 4.92, :y 0.0} {:x 5.48, :y 101.0} {:x 6.040000000000001, :y 76.0} {:x 6.600000000000001, :y 0.0} {:x 7.160000000000002, :y 48.0} {:x 7.720000000000002, :y 0.0} {:x 8.280000000000003, :y 42.0} {:x 8.840000000000003, :y 0.0} {:x 9.400000000000004, :y 40.0} {:x 9.960000000000004, :y 0.0} {:x 10.520000000000005, :y 24.0} {:x 11.080000000000005, :y 20.0} {:x 11.640000000000006, :y 0.0} {:x 12.200000000000006, :y 7.0} {:x 12.760000000000007, :y 0.0} {:x 13.320000000000007, :y 3.0} {:x 13.880000000000008, :y 0.0} {:x 14.440000000000008, :y 9.0} {:x 15.000000000000009, :y 5.0} {:x 15.56000000000001, :y 0.0} {:x 16.120000000000008, :y 4.0} {:x 16.680000000000007, :y 0.0} {:x 17.240000000000006, :y 3.0} {:x 17.800000000000004, :y 0.0} {:x 18.360000000000003, :y 6.0} {:x 18.92, :y 0.0} {:x 19.48, :y 3.0} {:x 20.04, :y 1.0} {:x 20.599999999999998, :y 0.0} {:x 21.159999999999997, :y 2.0} {:x 21.719999999999995, :y 0.0} {:x 22.279999999999994, :y 2.0} {:x 22.839999999999993, :y 0.0} {:x 23.39999999999999, :y 6.0} {:x 23.95999999999999, :y 0.0} {:x 24.51999999999999, :y 0.0} {:x 25.079999999999988, :y 0.0} {:x 25.639999999999986, :y 0.0} {:x 26.199999999999985, :y 1.0} {:x 26.759999999999984, :y 0.0} {:x 27.319999999999983, :y 1.0} {:x 27.87999999999998, :y 0.0} {:x 28.43999999999998, :y 0.0} {:x 28.99999999999998, :y 0.0} {:x 29.559999999999977, :y 0.0} {:x 30.119999999999976, :y 0.0} {:x 30.679999999999975, :y 0.0} {:x 31.239999999999974, :y 0.0} {:x 31.799999999999972, :y 0.0} {:x 32.35999999999997, :y 0.0} {:x 32.91999999999997, :y 0.0} {:x 33.479999999999976, :y 0.0} {:x 34.03999999999998, :y 0.0} {:x 34.59999999999998, :y 0.0} {:x 35.15999999999998, :y 0.0} {:x 35.719999999999985, :y 0.0} {:x 36.27999999999999, :y 0.0} {:x 36.83999999999999, :y 0.0} {:x 37.39999999999999, :y 0.0} {:x 37.959999999999994, :y 0.0} {:x 38.519999999999996, :y 0.0} {:x 39.08, :y 0.0} {:x 39.64, :y 0.0} {:x 40.2, :y 1.0} {:x 40.760000000000005, :y 0.0} {:x 41.32000000000001, :y 0.0} {:x 41.88000000000001, :y 0.0} {:x 42.44000000000001, :y 0.0} {:x 43.000000000000014, :y 0.0} {:x 43.56000000000002, :y 0.0} {:x 44.12000000000002, :y 0.0} {:x 44.68000000000002, :y 0.0} {:x 45.24000000000002, :y 0.0} {:x 45.800000000000026, :y 0.0} {:x 46.36000000000003, :y 0.0} {:x 46.92000000000003, :y 0.0} {:x 47.48000000000003, :y 0.0} {:x 48.040000000000035, :y 0.0} {:x 48.60000000000004, :y 0.0} {:x 49.16000000000004, :y 0.0} {:x 49.72000000000004, :y 0.0} {:x 50.280000000000044, :y 0.0} {:x 50.840000000000046, :y 0.0} {:x 51.40000000000005, :y 0.0} {:x 51.96000000000005, :y 0.0} {:x 52.52000000000005, :y 0.0} {:x 53.080000000000055, :y 0.0} {:x 53.64000000000006, :y 0.0} {:x 54.20000000000006, :y 0.0} {:x 54.76000000000006, :y 0.0} {:x 55.320000000000064, :y 0.0} {:x 55.88000000000007, :y 0.0} {:x 56.44000000000007, :y 1.0} {:x 57.00000000000007, :y 1.0} {:x 57.56000000000007, :y 0})}], :width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; @@
(let [delays (->> dpa-summary 
                  :analytics 
                  (map :delays) 
                  (map (fn [ds] (/ (reduce + ds) (count ds) 60)))
                  (remove #(> % 1440)))]
  (plot/histogram delays :plot-size 900 :bins 100))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"12db4ced-ee32-4b85-8ae0-7ebe1c800da5","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"12db4ced-ee32-4b85-8ae0-7ebe1c800da5","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"12db4ced-ee32-4b85-8ae0-7ebe1c800da5"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"12db4ced-ee32-4b85-8ae0-7ebe1c800da5","values":[{"x":0.0,"y":0},{"x":13.507833333333332,"y":477.0},{"x":27.015666666666664,"y":119.0},{"x":40.5235,"y":80.0},{"x":54.03133333333333,"y":53.0},{"x":67.53916666666666,"y":35.0},{"x":81.047,"y":31.0},{"x":94.55483333333333,"y":25.0},{"x":108.06266666666667,"y":20.0},{"x":121.57050000000001,"y":15.0},{"x":135.07833333333335,"y":15.0},{"x":148.58616666666668,"y":7.0},{"x":162.09400000000002,"y":6.0},{"x":175.60183333333336,"y":7.0},{"x":189.1096666666667,"y":3.0},{"x":202.61750000000004,"y":8.0},{"x":216.12533333333337,"y":3.0},{"x":229.6331666666667,"y":4.0},{"x":243.14100000000005,"y":2.0},{"x":256.64883333333336,"y":3.0},{"x":270.1566666666667,"y":1.0},{"x":283.66450000000003,"y":2.0},{"x":297.17233333333337,"y":2.0},{"x":310.6801666666667,"y":2.0},{"x":324.18800000000005,"y":0.0},{"x":337.6958333333334,"y":1.0},{"x":351.2036666666667,"y":1.0},{"x":364.71150000000006,"y":0.0},{"x":378.2193333333334,"y":3.0},{"x":391.72716666666673,"y":0.0},{"x":405.23500000000007,"y":0.0},{"x":418.7428333333334,"y":4.0},{"x":432.25066666666675,"y":0.0},{"x":445.7585000000001,"y":0.0},{"x":459.2663333333334,"y":0.0},{"x":472.77416666666676,"y":1.0},{"x":486.2820000000001,"y":1.0},{"x":499.78983333333343,"y":1.0},{"x":513.2976666666667,"y":0.0},{"x":526.8055,"y":0.0},{"x":540.3133333333334,"y":2.0},{"x":553.8211666666667,"y":0.0},{"x":567.3290000000001,"y":1.0},{"x":580.8368333333334,"y":0.0},{"x":594.3446666666667,"y":0.0},{"x":607.8525000000001,"y":3.0},{"x":621.3603333333334,"y":0.0},{"x":634.8681666666668,"y":1.0},{"x":648.3760000000001,"y":0.0},{"x":661.8838333333334,"y":0.0},{"x":675.3916666666668,"y":1.0},{"x":688.8995000000001,"y":0.0},{"x":702.4073333333334,"y":1.0},{"x":715.9151666666668,"y":0.0},{"x":729.4230000000001,"y":0.0},{"x":742.9308333333335,"y":1.0},{"x":756.4386666666668,"y":0.0},{"x":769.9465000000001,"y":2.0},{"x":783.4543333333335,"y":0.0},{"x":796.9621666666668,"y":0.0},{"x":810.4700000000001,"y":0.0},{"x":823.9778333333335,"y":1.0},{"x":837.4856666666668,"y":0.0},{"x":850.9935000000002,"y":1.0},{"x":864.5013333333335,"y":0.0},{"x":878.0091666666668,"y":0.0},{"x":891.5170000000002,"y":0.0},{"x":905.0248333333335,"y":0.0},{"x":918.5326666666668,"y":0.0},{"x":932.0405000000002,"y":1.0},{"x":945.5483333333335,"y":0.0},{"x":959.0561666666669,"y":1.0},{"x":972.5640000000002,"y":0.0},{"x":986.0718333333335,"y":1.0},{"x":999.5796666666669,"y":1.0},{"x":1013.0875000000002,"y":0.0},{"x":1026.5953333333334,"y":2.0},{"x":1040.1031666666668,"y":0.0},{"x":1053.611,"y":0.0},{"x":1067.1188333333334,"y":0.0},{"x":1080.6266666666668,"y":0.0},{"x":1094.1345000000001,"y":0.0},{"x":1107.6423333333335,"y":0.0},{"x":1121.1501666666668,"y":0.0},{"x":1134.6580000000001,"y":0.0},{"x":1148.1658333333335,"y":0.0},{"x":1161.6736666666668,"y":1.0},{"x":1175.1815000000001,"y":0.0},{"x":1188.6893333333335,"y":1.0},{"x":1202.1971666666668,"y":0.0},{"x":1215.7050000000002,"y":1.0},{"x":1229.2128333333335,"y":0.0},{"x":1242.7206666666668,"y":0.0},{"x":1256.2285000000002,"y":0.0},{"x":1269.7363333333335,"y":0.0},{"x":1283.2441666666668,"y":0.0},{"x":1296.7520000000002,"y":0.0},{"x":1310.2598333333335,"y":0.0},{"x":1323.7676666666669,"y":0.0},{"x":1337.2755000000002,"y":0.0},{"x":1350.7833333333335,"y":1.0},{"x":1364.2911666666669,"y":0}]}],"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"12db4ced-ee32-4b85-8ae0-7ebe1c800da5\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"12db4ced-ee32-4b85-8ae0-7ebe1c800da5\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"12db4ced-ee32-4b85-8ae0-7ebe1c800da5\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"12db4ced-ee32-4b85-8ae0-7ebe1c800da5\", :values ({:x 0.0, :y 0} {:x 13.507833333333332, :y 477.0} {:x 27.015666666666664, :y 119.0} {:x 40.5235, :y 80.0} {:x 54.03133333333333, :y 53.0} {:x 67.53916666666666, :y 35.0} {:x 81.047, :y 31.0} {:x 94.55483333333333, :y 25.0} {:x 108.06266666666667, :y 20.0} {:x 121.57050000000001, :y 15.0} {:x 135.07833333333335, :y 15.0} {:x 148.58616666666668, :y 7.0} {:x 162.09400000000002, :y 6.0} {:x 175.60183333333336, :y 7.0} {:x 189.1096666666667, :y 3.0} {:x 202.61750000000004, :y 8.0} {:x 216.12533333333337, :y 3.0} {:x 229.6331666666667, :y 4.0} {:x 243.14100000000005, :y 2.0} {:x 256.64883333333336, :y 3.0} {:x 270.1566666666667, :y 1.0} {:x 283.66450000000003, :y 2.0} {:x 297.17233333333337, :y 2.0} {:x 310.6801666666667, :y 2.0} {:x 324.18800000000005, :y 0.0} {:x 337.6958333333334, :y 1.0} {:x 351.2036666666667, :y 1.0} {:x 364.71150000000006, :y 0.0} {:x 378.2193333333334, :y 3.0} {:x 391.72716666666673, :y 0.0} {:x 405.23500000000007, :y 0.0} {:x 418.7428333333334, :y 4.0} {:x 432.25066666666675, :y 0.0} {:x 445.7585000000001, :y 0.0} {:x 459.2663333333334, :y 0.0} {:x 472.77416666666676, :y 1.0} {:x 486.2820000000001, :y 1.0} {:x 499.78983333333343, :y 1.0} {:x 513.2976666666667, :y 0.0} {:x 526.8055, :y 0.0} {:x 540.3133333333334, :y 2.0} {:x 553.8211666666667, :y 0.0} {:x 567.3290000000001, :y 1.0} {:x 580.8368333333334, :y 0.0} {:x 594.3446666666667, :y 0.0} {:x 607.8525000000001, :y 3.0} {:x 621.3603333333334, :y 0.0} {:x 634.8681666666668, :y 1.0} {:x 648.3760000000001, :y 0.0} {:x 661.8838333333334, :y 0.0} {:x 675.3916666666668, :y 1.0} {:x 688.8995000000001, :y 0.0} {:x 702.4073333333334, :y 1.0} {:x 715.9151666666668, :y 0.0} {:x 729.4230000000001, :y 0.0} {:x 742.9308333333335, :y 1.0} {:x 756.4386666666668, :y 0.0} {:x 769.9465000000001, :y 2.0} {:x 783.4543333333335, :y 0.0} {:x 796.9621666666668, :y 0.0} {:x 810.4700000000001, :y 0.0} {:x 823.9778333333335, :y 1.0} {:x 837.4856666666668, :y 0.0} {:x 850.9935000000002, :y 1.0} {:x 864.5013333333335, :y 0.0} {:x 878.0091666666668, :y 0.0} {:x 891.5170000000002, :y 0.0} {:x 905.0248333333335, :y 0.0} {:x 918.5326666666668, :y 0.0} {:x 932.0405000000002, :y 1.0} {:x 945.5483333333335, :y 0.0} {:x 959.0561666666669, :y 1.0} {:x 972.5640000000002, :y 0.0} {:x 986.0718333333335, :y 1.0} {:x 999.5796666666669, :y 1.0} {:x 1013.0875000000002, :y 0.0} {:x 1026.5953333333334, :y 2.0} {:x 1040.1031666666668, :y 0.0} {:x 1053.611, :y 0.0} {:x 1067.1188333333334, :y 0.0} {:x 1080.6266666666668, :y 0.0} {:x 1094.1345000000001, :y 0.0} {:x 1107.6423333333335, :y 0.0} {:x 1121.1501666666668, :y 0.0} {:x 1134.6580000000001, :y 0.0} {:x 1148.1658333333335, :y 0.0} {:x 1161.6736666666668, :y 1.0} {:x 1175.1815000000001, :y 0.0} {:x 1188.6893333333335, :y 1.0} {:x 1202.1971666666668, :y 0.0} {:x 1215.7050000000002, :y 1.0} {:x 1229.2128333333335, :y 0.0} {:x 1242.7206666666668, :y 0.0} {:x 1256.2285000000002, :y 0.0} {:x 1269.7363333333335, :y 0.0} {:x 1283.2441666666668, :y 0.0} {:x 1296.7520000000002, :y 0.0} {:x 1310.2598333333335, :y 0.0} {:x 1323.7676666666669, :y 0.0} {:x 1337.2755000000002, :y 0.0} {:x 1350.7833333333335, :y 1.0} {:x 1364.2911666666669, :y 0})}], :width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; @@
(let [heights (->> dpa-summary :analytics (map :height))]
  (plot/histogram heights :plot-size 900 :bins 10))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e","values":[{"x":0.0,"y":0},{"x":0.7000000000000001,"y":185.0},{"x":1.4000000000000001,"y":661.0},{"x":2.1,"y":92.0},{"x":2.8000000000000003,"y":0.0},{"x":3.5000000000000004,"y":15.0},{"x":4.2,"y":8.0},{"x":4.9,"y":0.0},{"x":5.6000000000000005,"y":1.0},{"x":6.300000000000001,"y":2.0},{"x":7.000000000000001,"y":1.0},{"x":7.700000000000001,"y":0}]}],"width":900,"height":556.2422485351562,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"26d75bbd-1c8a-4322-8af8-d0cdeb515d2e\", :values ({:x 0.0, :y 0} {:x 0.7000000000000001, :y 185.0} {:x 1.4000000000000001, :y 661.0} {:x 2.1, :y 92.0} {:x 2.8000000000000003, :y 0.0} {:x 3.5000000000000004, :y 15.0} {:x 4.2, :y 8.0} {:x 4.9, :y 0.0} {:x 5.6000000000000005, :y 1.0} {:x 6.300000000000001, :y 2.0} {:x 7.000000000000001, :y 1.0} {:x 7.700000000000001, :y 0})}], :width 900, :height 556.24225, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; @@
(let [hashtags (->> dpa-summary 
                  :analytics 
                  (map :hashtags) 
                  (apply concat)
                  (remove #{"dpa" "dpavolo"})
                  frequencies 
                  (sort-by second >) 
                  (take 20))]
  [(keys hashtags)
  (plot/bar-chart (keys hashtags) (vals hashtags) :plot-size 1000)])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>(&quot;ebola&quot; &quot;is&quot; &quot;sltw14&quot; &quot;wowereit&quot; &quot;ferguson&quot; &quot;snowden&quot; &quot;hongkong&quot; &quot;nsu&quot; &quot;uber&quot; &quot;afd&quot; &quot;indyref&quot; &quot;mh17&quot; &quot;china&quot; &quot;icebucketchallenge&quot; &quot;apple&quot; &quot;nsa&quot; &quot;news&quot; &quot;n24&quot; &quot;piraten&quot; &quot;tohti&quot;)</span>","value":"(\"ebola\" \"is\" \"sltw14\" \"wowereit\" \"ferguson\" \"snowden\" \"hongkong\" \"nsu\" \"uber\" \"afd\" \"indyref\" \"mh17\" \"china\" \"icebucketchallenge\" \"apple\" \"nsa\" \"news\" \"n24\" \"piraten\" \"tohti\")"},{"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"ordinal","range":"width","domain":{"data":"90c80f82-240c-4c0c-ab4c-a783e2a3b731","field":"data.x"}},{"name":"y","range":"height","nice":true,"domain":{"data":"90c80f82-240c-4c0c-ab4c-a783e2a3b731","field":"data.y"}}],"marks":[{"type":"rect","from":{"data":"90c80f82-240c-4c0c-ab4c-a783e2a3b731"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"steelblue"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}}],"data":[{"name":"90c80f82-240c-4c0c-ab4c-a783e2a3b731","values":[{"x":"ebola","y":47},{"x":"is","y":45},{"x":"sltw14","y":34},{"x":"wowereit","y":33},{"x":"ferguson","y":30},{"x":"snowden","y":27},{"x":"hongkong","y":25},{"x":"nsu","y":22},{"x":"uber","y":20},{"x":"afd","y":19},{"x":"indyref","y":18},{"x":"mh17","y":17},{"x":"china","y":17},{"x":"icebucketchallenge","y":16},{"x":"apple","y":15},{"x":"nsa","y":15},{"x":"news","y":14},{"x":"n24","y":14},{"x":"piraten","y":14},{"x":"tohti","y":13}]}],"width":1000,"height":618.0469970703125,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\", :values ({:x \"ebola\", :y 47} {:x \"is\", :y 45} {:x \"sltw14\", :y 34} {:x \"wowereit\", :y 33} {:x \"ferguson\", :y 30} {:x \"snowden\", :y 27} {:x \"hongkong\", :y 25} {:x \"nsu\", :y 22} {:x \"uber\", :y 20} {:x \"afd\", :y 19} {:x \"indyref\", :y 18} {:x \"mh17\", :y 17} {:x \"china\", :y 17} {:x \"icebucketchallenge\", :y 16} {:x \"apple\", :y 15} {:x \"nsa\", :y 15} {:x \"news\", :y 14} {:x \"n24\", :y 14} {:x \"piraten\", :y 14} {:x \"tohti\", :y 13})}], :width 1000, :height 618.047, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}],"value":"[(\"ebola\" \"is\" \"sltw14\" \"wowereit\" \"ferguson\" \"snowden\" \"hongkong\" \"nsu\" \"uber\" \"afd\" \"indyref\" \"mh17\" \"china\" \"icebucketchallenge\" \"apple\" \"nsa\" \"news\" \"n24\" \"piraten\" \"tohti\") #gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"90c80f82-240c-4c0c-ab4c-a783e2a3b731\", :values ({:x \"ebola\", :y 47} {:x \"is\", :y 45} {:x \"sltw14\", :y 34} {:x \"wowereit\", :y 33} {:x \"ferguson\", :y 30} {:x \"snowden\", :y 27} {:x \"hongkong\", :y 25} {:x \"nsu\", :y 22} {:x \"uber\", :y 20} {:x \"afd\", :y 19} {:x \"indyref\", :y 18} {:x \"mh17\", :y 17} {:x \"china\", :y 17} {:x \"icebucketchallenge\", :y 16} {:x \"apple\", :y 15} {:x \"nsa\", :y 15} {:x \"news\", :y 14} {:x \"n24\", :y 14} {:x \"piraten\", :y 14} {:x \"tohti\", :y 13})}], :width 1000, :height 618.047, :padding {:bottom 20, :top 10, :right 10, :left 50}}}]"}
;; <=

;; @@
(def dpa-users (->> dpa-summary 
                  :analytics 
                  (map :users)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/dpa-users</span>","value":"#'unsightly-reserve/dpa-users"}
;; <=

;; @@
(let [users (->> dpa-users
                 (apply concat)
                 (remove #{"dpa"})
                 frequencies 
                 (sort-by second >) 
                 (take 15))]
  [(keys users)
  (plot/bar-chart (keys users) (vals users) :plot-size 1000)])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>(&quot;Dietmar_Bauer&quot; &quot;alanyanews_eu&quot; &quot;thesirenofangel&quot; &quot;grimneko&quot; &quot;2014FL&quot; &quot;BBattmer&quot; &quot;S_Tagblatt&quot; &quot;Klostifan1981&quot; &quot;ChrisBrey1&quot; &quot;DietrichOpal&quot; &quot;martinromanczyk&quot; &quot;Dennis_Snehotta&quot; &quot;Liane13&quot; &quot;andreaslandwehr&quot; &quot;WOLKEFN&quot;)</span>","value":"(\"Dietmar_Bauer\" \"alanyanews_eu\" \"thesirenofangel\" \"grimneko\" \"2014FL\" \"BBattmer\" \"S_Tagblatt\" \"Klostifan1981\" \"ChrisBrey1\" \"DietrichOpal\" \"martinromanczyk\" \"Dennis_Snehotta\" \"Liane13\" \"andreaslandwehr\" \"WOLKEFN\")"},{"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"ordinal","range":"width","domain":{"data":"1a0f4889-685a-4e77-8947-83dcaa838d4b","field":"data.x"}},{"name":"y","range":"height","nice":true,"domain":{"data":"1a0f4889-685a-4e77-8947-83dcaa838d4b","field":"data.y"}}],"marks":[{"type":"rect","from":{"data":"1a0f4889-685a-4e77-8947-83dcaa838d4b"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"steelblue"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}}],"data":[{"name":"1a0f4889-685a-4e77-8947-83dcaa838d4b","values":[{"x":"Dietmar_Bauer","y":120},{"x":"alanyanews_eu","y":55},{"x":"thesirenofangel","y":47},{"x":"grimneko","y":32},{"x":"2014FL","y":30},{"x":"BBattmer","y":30},{"x":"S_Tagblatt","y":29},{"x":"Klostifan1981","y":26},{"x":"ChrisBrey1","y":24},{"x":"DietrichOpal","y":23},{"x":"martinromanczyk","y":22},{"x":"Dennis_Snehotta","y":21},{"x":"Liane13","y":20},{"x":"andreaslandwehr","y":19},{"x":"WOLKEFN","y":19}]}],"width":1000,"height":618.0469970703125,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"1a0f4889-685a-4e77-8947-83dcaa838d4b\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"1a0f4889-685a-4e77-8947-83dcaa838d4b\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"1a0f4889-685a-4e77-8947-83dcaa838d4b\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"1a0f4889-685a-4e77-8947-83dcaa838d4b\", :values ({:x \"Dietmar_Bauer\", :y 120} {:x \"alanyanews_eu\", :y 55} {:x \"thesirenofangel\", :y 47} {:x \"grimneko\", :y 32} {:x \"2014FL\", :y 30} {:x \"BBattmer\", :y 30} {:x \"S_Tagblatt\", :y 29} {:x \"Klostifan1981\", :y 26} {:x \"ChrisBrey1\", :y 24} {:x \"DietrichOpal\", :y 23} {:x \"martinromanczyk\", :y 22} {:x \"Dennis_Snehotta\", :y 21} {:x \"Liane13\", :y 20} {:x \"andreaslandwehr\", :y 19} {:x \"WOLKEFN\", :y 19})}], :width 1000, :height 618.047, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}],"value":"[(\"Dietmar_Bauer\" \"alanyanews_eu\" \"thesirenofangel\" \"grimneko\" \"2014FL\" \"BBattmer\" \"S_Tagblatt\" \"Klostifan1981\" \"ChrisBrey1\" \"DietrichOpal\" \"martinromanczyk\" \"Dennis_Snehotta\" \"Liane13\" \"andreaslandwehr\" \"WOLKEFN\") #gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"1a0f4889-685a-4e77-8947-83dcaa838d4b\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"1a0f4889-685a-4e77-8947-83dcaa838d4b\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"1a0f4889-685a-4e77-8947-83dcaa838d4b\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"1a0f4889-685a-4e77-8947-83dcaa838d4b\", :values ({:x \"Dietmar_Bauer\", :y 120} {:x \"alanyanews_eu\", :y 55} {:x \"thesirenofangel\", :y 47} {:x \"grimneko\", :y 32} {:x \"2014FL\", :y 30} {:x \"BBattmer\", :y 30} {:x \"S_Tagblatt\", :y 29} {:x \"Klostifan1981\", :y 26} {:x \"ChrisBrey1\", :y 24} {:x \"DietrichOpal\", :y 23} {:x \"martinromanczyk\", :y 22} {:x \"Dennis_Snehotta\", :y 21} {:x \"Liane13\", :y 20} {:x \"andreaslandwehr\", :y 19} {:x \"WOLKEFN\", :y 19})}], :width 1000, :height 618.047, :padding {:bottom 20, :top 10, :right 10, :left 50}}}]"}
;; <=

;; **
;;; ### Unique users
;; **

;; @@
(float (/ (->> dpa-users (apply concat) frequencies vals (remove #(> % 1)) count) 
          (->> dpa-users (apply concat) (into #{}) count)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>0.6464471</span>","value":"0.6464471"}
;; <=

;; @@

;; @@

;; **
;;; ## August Inspection
;; **

;; @@
(def source-tweet-counts (->> (mc/find-maps @db "users" {:screen_name {$in news-accounts}})
     			    	 (pmap (fn [{:keys [screen_name _id]}] [screen_name (mc/count @db "publications" {:user _id})]))
                         (into {})))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/source-tweet-counts</span>","value":"#'unsightly-reserve/source-tweet-counts"}
;; <=

;; @@
(def source-url-counts (->> (mc/find-maps @db "users" {:screen_name {$in news-accounts}})
                            (pmap (fn [{:keys [screen_name _id]}] [screen_name (mc/count @db "urls" {:user _id})]))
                            (into {})))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/source-url-counts</span>","value":"#'unsightly-reserve/source-url-counts"}
;; <=

;; @@
(plot/compose
  (plot/bar-chart (keys source-tweet-counts) (vals source-tweet-counts) :plot-size 1000  :colour "red")
  (plot/bar-chart (keys source-url-counts) (vals source-url-counts)))
;; @@
;; =>
;;; {"type":"vega","content":{"width":1000,"height":618.0469970703125,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"ordinal","range":"width","domain":{"data":"ff1c3d52-a88d-4701-a8ad-c057738d4b39","field":"data.x"}},{"name":"y","range":"height","nice":true,"domain":{"data":"ff1c3d52-a88d-4701-a8ad-c057738d4b39","field":"data.y"}}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"ff1c3d52-a88d-4701-a8ad-c057738d4b39","values":[{"x":"dpa","y":520},{"x":"tazgezwitscher","y":700},{"x":"BILD","y":1327},{"x":"ZDFheute","y":950},{"x":"FAZ_NET","y":2919},{"x":"focusonline","y":271},{"x":"welt","y":1992},{"x":"N24_de","y":1962},{"x":"DerWesten","y":947},{"x":"SPIEGELONLINE","y":1765},{"x":"ntvde","y":1816},{"x":"tagesschau","y":1738},{"x":"SZ","y":1617},{"x":"sternde","y":982}]},{"name":"f45e11e2-50b3-45f8-b49a-6b6b8907edf5","values":[{"x":"dpa","y":445},{"x":"tazgezwitscher","y":639},{"x":"BILD","y":983},{"x":"ZDFheute","y":530},{"x":"FAZ_NET","y":2187},{"x":"focusonline","y":266},{"x":"welt","y":1798},{"x":"N24_de","y":1940},{"x":"DerWesten","y":854},{"x":"SPIEGELONLINE","y":1643},{"x":"ntvde","y":1793},{"x":"tagesschau","y":1282},{"x":"SZ","y":1525},{"x":"sternde","y":895}]}],"marks":[{"type":"rect","from":{"data":"ff1c3d52-a88d-4701-a8ad-c057738d4b39"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"red"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}},{"type":"rect","from":{"data":"f45e11e2-50b3-45f8-b49a-6b6b8907edf5"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"steelblue"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 1000, :height 618.047, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"ff1c3d52-a88d-4701-a8ad-c057738d4b39\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"ff1c3d52-a88d-4701-a8ad-c057738d4b39\", :field \"data.y\"}}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"ff1c3d52-a88d-4701-a8ad-c057738d4b39\", :values ({:x \"dpa\", :y 520} {:x \"tazgezwitscher\", :y 700} {:x \"BILD\", :y 1327} {:x \"ZDFheute\", :y 950} {:x \"FAZ_NET\", :y 2919} {:x \"focusonline\", :y 271} {:x \"welt\", :y 1992} {:x \"N24_de\", :y 1962} {:x \"DerWesten\", :y 947} {:x \"SPIEGELONLINE\", :y 1765} {:x \"ntvde\", :y 1816} {:x \"tagesschau\", :y 1738} {:x \"SZ\", :y 1617} {:x \"sternde\", :y 982})} {:name \"f45e11e2-50b3-45f8-b49a-6b6b8907edf5\", :values ({:x \"dpa\", :y 445} {:x \"tazgezwitscher\", :y 639} {:x \"BILD\", :y 983} {:x \"ZDFheute\", :y 530} {:x \"FAZ_NET\", :y 2187} {:x \"focusonline\", :y 266} {:x \"welt\", :y 1798} {:x \"N24_de\", :y 1940} {:x \"DerWesten\", :y 854} {:x \"SPIEGELONLINE\", :y 1643} {:x \"ntvde\", :y 1793} {:x \"tagesschau\", :y 1282} {:x \"SZ\", :y 1525} {:x \"sternde\", :y 895})}), :marks ({:type \"rect\", :from {:data \"ff1c3d52-a88d-4701-a8ad-c057738d4b39\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"red\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}} {:type \"rect\", :from {:data \"f45e11e2-50b3-45f8-b49a-6b6b8907edf5\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}})}}"}
;; <=

;; **
;;; # Overall Statistics
;; **

;; **
;;; ## Tree Size (Degree)
;; **

;; @@
(def short-summary 
  (let [users (map :_id (mc/find-maps @db "users" {:screen_name {$in news-accounts}}))
        reaction-forest (pmap #(analyzer/reaction-tree (:_id %)) (mc/find-maps @db "publications" {:user {$in users}}))]
         (pmap summary reaction-forest)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/short-summary</span>","value":"#'unsightly-reserve/short-summary"}
;; <=

;; @@
(short-metrics (map :size short-summary))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>6.256382651491848</span>","value":"6.256382651491848"}],"value":"[:mean 6.256382651491848]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>9.295702839327964</span>","value":"9.295702839327964"}],"value":"[:std 9.295702839327964]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(1.0 1.0 3.0 8.0 207.0)</span>","value":"(1.0 1.0 3.0 8.0 207.0)"}],"value":"[:quantiles (1.0 1.0 3.0 8.0 207.0)]"}],"value":"{:mean 6.256382651491848, :std 9.295702839327964, :quantiles (1.0 1.0 3.0 8.0 207.0)}"}
;; <=

;; @@
(let [sizes (map :size short-summary)
      size-freq (frequencies sizes)
      counter (count sizes)
      freq-vec (->> (map vector (keys size-freq) (vals size-freq))
                    (map (fn [[k v]] [(Math/log10 k) (/ v counter)]))
                    (sort-by first >))]
  (plot/list-plot freq-vec :joined true))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"83933726-f732-45d8-8b64-f958fe801ee0","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"83933726-f732-45d8-8b64-f958fe801ee0","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"83933726-f732-45d8-8b64-f958fe801ee0"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"83933726-f732-45d8-8b64-f958fe801ee0","values":[{"x":2.315970345456918,"y":5.126627704296114E-5},{"x":2.307496037913213,"y":5.126627704296114E-5},{"x":2.3010299956639813,"y":5.126627704296114E-5},{"x":2.296665190261531,"y":5.126627704296114E-5},{"x":2.292256071356476,"y":5.126627704296114E-5},{"x":2.2671717284030137,"y":5.126627704296114E-5},{"x":2.2278867046136734,"y":5.126627704296114E-5},{"x":2.1903316981702914,"y":5.126627704296114E-5},{"x":2.1522883443830563,"y":5.126627704296114E-5},{"x":2.1335389083702174,"y":5.126627704296114E-5},{"x":2.100370545117563,"y":1.025325540859223E-4},{"x":2.093421685162235,"y":5.126627704296114E-5},{"x":2.089905111439398,"y":5.126627704296114E-5},{"x":2.0863598306747484,"y":5.126627704296114E-5},{"x":2.0827853703164503,"y":5.126627704296114E-5},{"x":2.041392685158225,"y":5.126627704296114E-5},{"x":2.0293837776852097,"y":5.126627704296114E-5},{"x":2.0170333392987803,"y":5.126627704296114E-5},{"x":2.0086001717619175,"y":5.126627704296114E-5},{"x":1.9912260756924949,"y":5.126627704296114E-5},{"x":1.9867717342662448,"y":5.126627704296114E-5},{"x":1.9822712330395684,"y":1.025325540859223E-4},{"x":1.9731278535996986,"y":5.126627704296114E-5},{"x":1.9590413923210936,"y":5.126627704296114E-5},{"x":1.954242509439325,"y":5.126627704296114E-5},{"x":1.9493900066449128,"y":1.025325540859223E-4},{"x":1.9344984512435677,"y":2.563313852148057E-4},{"x":1.9084850188786497,"y":1.025325540859223E-4},{"x":1.8976270912904414,"y":1.025325540859223E-4},{"x":1.8920946026904804,"y":1.025325540859223E-4},{"x":1.8864907251724818,"y":5.126627704296114E-5},{"x":1.8808135922807914,"y":1.025325540859223E-4},{"x":1.8750612633917,"y":5.126627704296114E-5},{"x":1.8692317197309762,"y":1.025325540859223E-4},{"x":1.8573324964312685,"y":1.025325540859223E-4},{"x":1.8512583487190752,"y":2.050651081718446E-4},{"x":1.845098040014257,"y":2.050651081718446E-4},{"x":1.8388490907372552,"y":1.537988311288834E-4},{"x":1.8325089127062364,"y":5.126627704296114E-5},{"x":1.8260748027008264,"y":1.025325540859223E-4},{"x":1.8195439355418688,"y":5.126627704296114E-5},{"x":1.8129133566428555,"y":1.025325540859223E-4},{"x":1.7993405494535817,"y":1.537988311288834E-4},{"x":1.792391689498254,"y":1.537988311288834E-4},{"x":1.7853298350107671,"y":2.563313852148057E-4},{"x":1.7781512503836436,"y":1.537988311288834E-4},{"x":1.7708520116421442,"y":3.58863939300728E-4},{"x":1.7634279935629373,"y":1.025325540859223E-4},{"x":1.7558748556724915,"y":5.126627704296114E-5},{"x":1.7481880270062005,"y":2.050651081718446E-4},{"x":1.7403626894942439,"y":2.563313852148057E-4},{"x":1.7323937598229686,"y":2.050651081718446E-4},{"x":1.724275869600789,"y":1.537988311288834E-4},{"x":1.7160033436347992,"y":1.537988311288834E-4},{"x":1.7075701760979363,"y":2.563313852148057E-4},{"x":1.6989700043360187,"y":6.664616015584948E-4},{"x":1.6901960800285136,"y":4.101302163436891E-4},{"x":1.6812412373755872,"y":2.563313852148057E-4},{"x":1.6720978579357175,"y":3.58863939300728E-4},{"x":1.662757831681574,"y":3.58863939300728E-4},{"x":1.6532125137753437,"y":3.075976622577668E-4},{"x":1.6434526764861874,"y":6.151953245155337E-4},{"x":1.6334684555795864,"y":4.613964933866503E-4},{"x":1.6232492903979006,"y":6.151953245155337E-4},{"x":1.6127838567197355,"y":5.126627704296114E-4},{"x":1.6020599913279623,"y":5.126627704296114E-4},{"x":1.591064607026499,"y":0.001025325540859223},{"x":1.5797835966168101,"y":7.689941556444171E-4},{"x":1.568201724066995,"y":7.689941556444171E-4},{"x":1.5563025007672873,"y":6.151953245155337E-4},{"x":1.5440680443502757,"y":0.001076591817902184},{"x":1.5314789170422551,"y":9.740592638162617E-4},{"x":1.5185139398778875,"y":0.001948118527632523},{"x":1.505149978319906,"y":0.001281656926074029},{"x":1.4913616938342726,"y":0.001486722034245873},{"x":1.4771212547196624,"y":0.001845585973546601},{"x":1.462397997898956,"y":0.001845585973546601},{"x":1.4471580313422192,"y":0.002153183635804368},{"x":1.4313637641589874,"y":0.002306982466933251},{"x":1.414973347970818,"y":0.002563313852148057},{"x":1.3979400086720377,"y":0.002665846406233979},{"x":1.380211241711606,"y":0.002358248743976212},{"x":1.3617278360175928,"y":0.003742438224136163},{"x":1.3424226808222062,"y":0.002922177791448785},{"x":1.3222192947339193,"y":0.004870296319081308},{"x":1.3010299956639813,"y":0.005741823028811648},{"x":1.2787536009528289,"y":0.007484876448272326},{"x":1.255272505103306,"y":0.008253870603916745},{"x":1.2304489213782739,"y":0.007997539218701938},{"x":1.2041199826559248,"y":0.008920332205475239},{"x":1.1760912590556813,"y":0.01132984722649441},{"x":1.146128035678238,"y":0.01317543320004101},{"x":1.1139433523068367,"y":0.01455962268020096},{"x":1.0791812460476249,"y":0.01737926791756383},{"x":1.0413926851582251,"y":0.02081410847944222},{"x":1.0,"y":0.02481287808879319},{"x":0.9542425094393249,"y":0.02993950579308931},{"x":0.9030899869919435,"y":0.03475853583512765},{"x":0.8450980400142568,"y":0.044857992412591},{"x":0.7781512503836436,"y":0.05265046652312109},{"x":0.6989700043360189,"y":0.06326258587101405},{"x":0.6020599913279624,"y":0.07766840972008612},{"x":0.47712125471966244,"y":0.09714959499641136},{"x":0.3010299956639812,"y":0.1209884138213883},{"x":0.0,"y":0.2901671280631601}]}],"width":400,"height":247.2187957763672,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"83933726-f732-45d8-8b64-f958fe801ee0\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"83933726-f732-45d8-8b64-f958fe801ee0\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"83933726-f732-45d8-8b64-f958fe801ee0\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"83933726-f732-45d8-8b64-f958fe801ee0\", :values ({:x 2.315970345456918, :y 1/19506} {:x 2.307496037913213, :y 1/19506} {:x 2.3010299956639813, :y 1/19506} {:x 2.296665190261531, :y 1/19506} {:x 2.292256071356476, :y 1/19506} {:x 2.2671717284030137, :y 1/19506} {:x 2.2278867046136734, :y 1/19506} {:x 2.1903316981702914, :y 1/19506} {:x 2.1522883443830563, :y 1/19506} {:x 2.1335389083702174, :y 1/19506} {:x 2.100370545117563, :y 1/9753} {:x 2.093421685162235, :y 1/19506} {:x 2.089905111439398, :y 1/19506} {:x 2.0863598306747484, :y 1/19506} {:x 2.0827853703164503, :y 1/19506} {:x 2.041392685158225, :y 1/19506} {:x 2.0293837776852097, :y 1/19506} {:x 2.0170333392987803, :y 1/19506} {:x 2.0086001717619175, :y 1/19506} {:x 1.9912260756924949, :y 1/19506} {:x 1.9867717342662448, :y 1/19506} {:x 1.9822712330395684, :y 1/9753} {:x 1.9731278535996986, :y 1/19506} {:x 1.9590413923210936, :y 1/19506} {:x 1.954242509439325, :y 1/19506} {:x 1.9493900066449128, :y 1/9753} {:x 1.9344984512435677, :y 5/19506} {:x 1.9084850188786497, :y 1/9753} {:x 1.8976270912904414, :y 1/9753} {:x 1.8920946026904804, :y 1/9753} {:x 1.8864907251724818, :y 1/19506} {:x 1.8808135922807914, :y 1/9753} {:x 1.8750612633917, :y 1/19506} {:x 1.8692317197309762, :y 1/9753} {:x 1.8573324964312685, :y 1/9753} {:x 1.8512583487190752, :y 2/9753} {:x 1.845098040014257, :y 2/9753} {:x 1.8388490907372552, :y 1/6502} {:x 1.8325089127062364, :y 1/19506} {:x 1.8260748027008264, :y 1/9753} {:x 1.8195439355418688, :y 1/19506} {:x 1.8129133566428555, :y 1/9753} {:x 1.7993405494535817, :y 1/6502} {:x 1.792391689498254, :y 1/6502} {:x 1.7853298350107671, :y 5/19506} {:x 1.7781512503836436, :y 1/6502} {:x 1.7708520116421442, :y 7/19506} {:x 1.7634279935629373, :y 1/9753} {:x 1.7558748556724915, :y 1/19506} {:x 1.7481880270062005, :y 2/9753} {:x 1.7403626894942439, :y 5/19506} {:x 1.7323937598229686, :y 2/9753} {:x 1.724275869600789, :y 1/6502} {:x 1.7160033436347992, :y 1/6502} {:x 1.7075701760979363, :y 5/19506} {:x 1.6989700043360187, :y 13/19506} {:x 1.6901960800285136, :y 4/9753} {:x 1.6812412373755872, :y 5/19506} {:x 1.6720978579357175, :y 7/19506} {:x 1.662757831681574, :y 7/19506} {:x 1.6532125137753437, :y 1/3251} {:x 1.6434526764861874, :y 2/3251} {:x 1.6334684555795864, :y 3/6502} {:x 1.6232492903979006, :y 2/3251} {:x 1.6127838567197355, :y 5/9753} {:x 1.6020599913279623, :y 5/9753} {:x 1.591064607026499, :y 10/9753} {:x 1.5797835966168101, :y 5/6502} {:x 1.568201724066995, :y 5/6502} {:x 1.5563025007672873, :y 2/3251} {:x 1.5440680443502757, :y 7/6502} {:x 1.5314789170422551, :y 19/19506} {:x 1.5185139398778875, :y 19/9753} {:x 1.505149978319906, :y 25/19506} {:x 1.4913616938342726, :y 29/19506} {:x 1.4771212547196624, :y 6/3251} {:x 1.462397997898956, :y 6/3251} {:x 1.4471580313422192, :y 7/3251} {:x 1.4313637641589874, :y 15/6502} {:x 1.414973347970818, :y 25/9753} {:x 1.3979400086720377, :y 26/9753} {:x 1.380211241711606, :y 23/9753} {:x 1.3617278360175928, :y 73/19506} {:x 1.3424226808222062, :y 19/6502} {:x 1.3222192947339193, :y 95/19506} {:x 1.3010299956639813, :y 56/9753} {:x 1.2787536009528289, :y 73/9753} {:x 1.255272505103306, :y 161/19506} {:x 1.2304489213782739, :y 26/3251} {:x 1.2041199826559248, :y 29/3251} {:x 1.1760912590556813, :y 221/19506} {:x 1.146128035678238, :y 257/19506} {:x 1.1139433523068367, :y 142/9753} {:x 1.0791812460476249, :y 113/6502} {:x 1.0413926851582251, :y 203/9753} {:x 1.0, :y 242/9753} {:x 0.9542425094393249, :y 292/9753} {:x 0.9030899869919435, :y 113/3251} {:x 0.8450980400142568, :y 875/19506} {:x 0.7781512503836436, :y 1027/19506} {:x 0.6989700043360189, :y 617/9753} {:x 0.6020599913279624, :y 505/6502} {:x 0.47712125471966244, :y 1895/19506} {:x 0.3010299956639812, :y 1180/9753} {:x 0.0, :y 2830/9753})}], :width 400, :height 247.2188, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; **
;;; ### Tree Height
;; **

;; @@
(short-metrics (map :height short-summary))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>0.9199220752588947</span>","value":"0.9199220752588947"}],"value":"[:mean 0.9199220752588947]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>1.2241883778207152</span>","value":"1.2241883778207152"}],"value":"[:std 1.2241883778207152]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(0.0 0.0 1.0 1.0 48.0)</span>","value":"(0.0 0.0 1.0 1.0 48.0)"}],"value":"[:quantiles (0.0 0.0 1.0 1.0 48.0)]"}],"value":"{:mean 0.9199220752588947, :std 1.2241883778207152, :quantiles (0.0 0.0 1.0 1.0 48.0)}"}
;; <=

;; @@
(let [sizes (map :size short-summary)
      size-freq (frequencies sizes)
      counter (count sizes)
      freq-vec (->> (map vector (keys size-freq) (vals size-freq))
                    (map (fn [[k v]] [(Math/log10 k) (/ v counter)]))
                    (sort-by first >))]
  (plot/list-plot freq-vec :joined true))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"f1f3990c-b894-467a-8117-519bd56dbed4","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"f1f3990c-b894-467a-8117-519bd56dbed4","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"f1f3990c-b894-467a-8117-519bd56dbed4"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"f1f3990c-b894-467a-8117-519bd56dbed4","values":[{"x":2.315970345456918,"y":5.126627704296114E-5},{"x":2.307496037913213,"y":5.126627704296114E-5},{"x":2.3010299956639813,"y":5.126627704296114E-5},{"x":2.296665190261531,"y":5.126627704296114E-5},{"x":2.292256071356476,"y":5.126627704296114E-5},{"x":2.2671717284030137,"y":5.126627704296114E-5},{"x":2.2278867046136734,"y":5.126627704296114E-5},{"x":2.1903316981702914,"y":5.126627704296114E-5},{"x":2.1522883443830563,"y":5.126627704296114E-5},{"x":2.1335389083702174,"y":5.126627704296114E-5},{"x":2.100370545117563,"y":1.025325540859223E-4},{"x":2.093421685162235,"y":5.126627704296114E-5},{"x":2.089905111439398,"y":5.126627704296114E-5},{"x":2.0863598306747484,"y":5.126627704296114E-5},{"x":2.0827853703164503,"y":5.126627704296114E-5},{"x":2.041392685158225,"y":5.126627704296114E-5},{"x":2.0293837776852097,"y":5.126627704296114E-5},{"x":2.0170333392987803,"y":5.126627704296114E-5},{"x":2.0086001717619175,"y":5.126627704296114E-5},{"x":1.9912260756924949,"y":5.126627704296114E-5},{"x":1.9867717342662448,"y":5.126627704296114E-5},{"x":1.9822712330395684,"y":1.025325540859223E-4},{"x":1.9731278535996986,"y":5.126627704296114E-5},{"x":1.9590413923210936,"y":5.126627704296114E-5},{"x":1.954242509439325,"y":5.126627704296114E-5},{"x":1.9493900066449128,"y":1.025325540859223E-4},{"x":1.9344984512435677,"y":2.563313852148057E-4},{"x":1.9084850188786497,"y":1.025325540859223E-4},{"x":1.8976270912904414,"y":1.025325540859223E-4},{"x":1.8920946026904804,"y":1.025325540859223E-4},{"x":1.8864907251724818,"y":5.126627704296114E-5},{"x":1.8808135922807914,"y":1.025325540859223E-4},{"x":1.8750612633917,"y":5.126627704296114E-5},{"x":1.8692317197309762,"y":1.025325540859223E-4},{"x":1.8573324964312685,"y":1.025325540859223E-4},{"x":1.8512583487190752,"y":2.050651081718446E-4},{"x":1.845098040014257,"y":2.050651081718446E-4},{"x":1.8388490907372552,"y":1.537988311288834E-4},{"x":1.8325089127062364,"y":5.126627704296114E-5},{"x":1.8260748027008264,"y":1.025325540859223E-4},{"x":1.8195439355418688,"y":5.126627704296114E-5},{"x":1.8129133566428555,"y":1.025325540859223E-4},{"x":1.7993405494535817,"y":1.537988311288834E-4},{"x":1.792391689498254,"y":1.537988311288834E-4},{"x":1.7853298350107671,"y":2.563313852148057E-4},{"x":1.7781512503836436,"y":1.537988311288834E-4},{"x":1.7708520116421442,"y":3.58863939300728E-4},{"x":1.7634279935629373,"y":1.025325540859223E-4},{"x":1.7558748556724915,"y":5.126627704296114E-5},{"x":1.7481880270062005,"y":2.050651081718446E-4},{"x":1.7403626894942439,"y":2.563313852148057E-4},{"x":1.7323937598229686,"y":2.050651081718446E-4},{"x":1.724275869600789,"y":1.537988311288834E-4},{"x":1.7160033436347992,"y":1.537988311288834E-4},{"x":1.7075701760979363,"y":2.563313852148057E-4},{"x":1.6989700043360187,"y":6.664616015584948E-4},{"x":1.6901960800285136,"y":4.101302163436891E-4},{"x":1.6812412373755872,"y":2.563313852148057E-4},{"x":1.6720978579357175,"y":3.58863939300728E-4},{"x":1.662757831681574,"y":3.58863939300728E-4},{"x":1.6532125137753437,"y":3.075976622577668E-4},{"x":1.6434526764861874,"y":6.151953245155337E-4},{"x":1.6334684555795864,"y":4.613964933866503E-4},{"x":1.6232492903979006,"y":6.151953245155337E-4},{"x":1.6127838567197355,"y":5.126627704296114E-4},{"x":1.6020599913279623,"y":5.126627704296114E-4},{"x":1.591064607026499,"y":0.001025325540859223},{"x":1.5797835966168101,"y":7.689941556444171E-4},{"x":1.568201724066995,"y":7.689941556444171E-4},{"x":1.5563025007672873,"y":6.151953245155337E-4},{"x":1.5440680443502757,"y":0.001076591817902184},{"x":1.5314789170422551,"y":9.740592638162617E-4},{"x":1.5185139398778875,"y":0.001948118527632523},{"x":1.505149978319906,"y":0.001281656926074029},{"x":1.4913616938342726,"y":0.001486722034245873},{"x":1.4771212547196624,"y":0.001845585973546601},{"x":1.462397997898956,"y":0.001845585973546601},{"x":1.4471580313422192,"y":0.002153183635804368},{"x":1.4313637641589874,"y":0.002306982466933251},{"x":1.414973347970818,"y":0.002563313852148057},{"x":1.3979400086720377,"y":0.002665846406233979},{"x":1.380211241711606,"y":0.002358248743976212},{"x":1.3617278360175928,"y":0.003742438224136163},{"x":1.3424226808222062,"y":0.002922177791448785},{"x":1.3222192947339193,"y":0.004870296319081308},{"x":1.3010299956639813,"y":0.005741823028811648},{"x":1.2787536009528289,"y":0.007484876448272326},{"x":1.255272505103306,"y":0.008253870603916745},{"x":1.2304489213782739,"y":0.007997539218701938},{"x":1.2041199826559248,"y":0.008920332205475239},{"x":1.1760912590556813,"y":0.01132984722649441},{"x":1.146128035678238,"y":0.01317543320004101},{"x":1.1139433523068367,"y":0.01455962268020096},{"x":1.0791812460476249,"y":0.01737926791756383},{"x":1.0413926851582251,"y":0.02081410847944222},{"x":1.0,"y":0.02481287808879319},{"x":0.9542425094393249,"y":0.02993950579308931},{"x":0.9030899869919435,"y":0.03475853583512765},{"x":0.8450980400142568,"y":0.044857992412591},{"x":0.7781512503836436,"y":0.05265046652312109},{"x":0.6989700043360189,"y":0.06326258587101405},{"x":0.6020599913279624,"y":0.07766840972008612},{"x":0.47712125471966244,"y":0.09714959499641136},{"x":0.3010299956639812,"y":0.1209884138213883},{"x":0.0,"y":0.2901671280631601}]}],"width":400,"height":247.2187957763672,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"f1f3990c-b894-467a-8117-519bd56dbed4\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"f1f3990c-b894-467a-8117-519bd56dbed4\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"f1f3990c-b894-467a-8117-519bd56dbed4\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"f1f3990c-b894-467a-8117-519bd56dbed4\", :values ({:x 2.315970345456918, :y 1/19506} {:x 2.307496037913213, :y 1/19506} {:x 2.3010299956639813, :y 1/19506} {:x 2.296665190261531, :y 1/19506} {:x 2.292256071356476, :y 1/19506} {:x 2.2671717284030137, :y 1/19506} {:x 2.2278867046136734, :y 1/19506} {:x 2.1903316981702914, :y 1/19506} {:x 2.1522883443830563, :y 1/19506} {:x 2.1335389083702174, :y 1/19506} {:x 2.100370545117563, :y 1/9753} {:x 2.093421685162235, :y 1/19506} {:x 2.089905111439398, :y 1/19506} {:x 2.0863598306747484, :y 1/19506} {:x 2.0827853703164503, :y 1/19506} {:x 2.041392685158225, :y 1/19506} {:x 2.0293837776852097, :y 1/19506} {:x 2.0170333392987803, :y 1/19506} {:x 2.0086001717619175, :y 1/19506} {:x 1.9912260756924949, :y 1/19506} {:x 1.9867717342662448, :y 1/19506} {:x 1.9822712330395684, :y 1/9753} {:x 1.9731278535996986, :y 1/19506} {:x 1.9590413923210936, :y 1/19506} {:x 1.954242509439325, :y 1/19506} {:x 1.9493900066449128, :y 1/9753} {:x 1.9344984512435677, :y 5/19506} {:x 1.9084850188786497, :y 1/9753} {:x 1.8976270912904414, :y 1/9753} {:x 1.8920946026904804, :y 1/9753} {:x 1.8864907251724818, :y 1/19506} {:x 1.8808135922807914, :y 1/9753} {:x 1.8750612633917, :y 1/19506} {:x 1.8692317197309762, :y 1/9753} {:x 1.8573324964312685, :y 1/9753} {:x 1.8512583487190752, :y 2/9753} {:x 1.845098040014257, :y 2/9753} {:x 1.8388490907372552, :y 1/6502} {:x 1.8325089127062364, :y 1/19506} {:x 1.8260748027008264, :y 1/9753} {:x 1.8195439355418688, :y 1/19506} {:x 1.8129133566428555, :y 1/9753} {:x 1.7993405494535817, :y 1/6502} {:x 1.792391689498254, :y 1/6502} {:x 1.7853298350107671, :y 5/19506} {:x 1.7781512503836436, :y 1/6502} {:x 1.7708520116421442, :y 7/19506} {:x 1.7634279935629373, :y 1/9753} {:x 1.7558748556724915, :y 1/19506} {:x 1.7481880270062005, :y 2/9753} {:x 1.7403626894942439, :y 5/19506} {:x 1.7323937598229686, :y 2/9753} {:x 1.724275869600789, :y 1/6502} {:x 1.7160033436347992, :y 1/6502} {:x 1.7075701760979363, :y 5/19506} {:x 1.6989700043360187, :y 13/19506} {:x 1.6901960800285136, :y 4/9753} {:x 1.6812412373755872, :y 5/19506} {:x 1.6720978579357175, :y 7/19506} {:x 1.662757831681574, :y 7/19506} {:x 1.6532125137753437, :y 1/3251} {:x 1.6434526764861874, :y 2/3251} {:x 1.6334684555795864, :y 3/6502} {:x 1.6232492903979006, :y 2/3251} {:x 1.6127838567197355, :y 5/9753} {:x 1.6020599913279623, :y 5/9753} {:x 1.591064607026499, :y 10/9753} {:x 1.5797835966168101, :y 5/6502} {:x 1.568201724066995, :y 5/6502} {:x 1.5563025007672873, :y 2/3251} {:x 1.5440680443502757, :y 7/6502} {:x 1.5314789170422551, :y 19/19506} {:x 1.5185139398778875, :y 19/9753} {:x 1.505149978319906, :y 25/19506} {:x 1.4913616938342726, :y 29/19506} {:x 1.4771212547196624, :y 6/3251} {:x 1.462397997898956, :y 6/3251} {:x 1.4471580313422192, :y 7/3251} {:x 1.4313637641589874, :y 15/6502} {:x 1.414973347970818, :y 25/9753} {:x 1.3979400086720377, :y 26/9753} {:x 1.380211241711606, :y 23/9753} {:x 1.3617278360175928, :y 73/19506} {:x 1.3424226808222062, :y 19/6502} {:x 1.3222192947339193, :y 95/19506} {:x 1.3010299956639813, :y 56/9753} {:x 1.2787536009528289, :y 73/9753} {:x 1.255272505103306, :y 161/19506} {:x 1.2304489213782739, :y 26/3251} {:x 1.2041199826559248, :y 29/3251} {:x 1.1760912590556813, :y 221/19506} {:x 1.146128035678238, :y 257/19506} {:x 1.1139433523068367, :y 142/9753} {:x 1.0791812460476249, :y 113/6502} {:x 1.0413926851582251, :y 203/9753} {:x 1.0, :y 242/9753} {:x 0.9542425094393249, :y 292/9753} {:x 0.9030899869919435, :y 113/3251} {:x 0.8450980400142568, :y 875/19506} {:x 0.7781512503836436, :y 1027/19506} {:x 0.6989700043360189, :y 617/9753} {:x 0.6020599913279624, :y 505/6502} {:x 0.47712125471966244, :y 1895/19506} {:x 0.3010299956639812, :y 1180/9753} {:x 0.0, :y 2830/9753})}], :width 400, :height 247.2188, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; **
;;; ## User Posts
;; **

;; @@
(def user-posts
  (->> (mc/find-maps @db "publications")
       (map :user)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/user-posts</span>","value":"#'unsightly-reserve/user-posts"}
;; <=

;; @@
(short-metrics (vals (frequencies user-posts)))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>4.3545068996075456</span>","value":"4.3545068996075456"}],"value":"[:mean 4.3545068996075456]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>30.266754180296076</span>","value":"30.266754180296076"}],"value":"[:std 30.266754180296076]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(1.0 1.0 1.0 2.0 2919.0)</span>","value":"(1.0 1.0 1.0 2.0 2919.0)"}],"value":"[:quantiles (1.0 1.0 1.0 2.0 2919.0)]"}],"value":"{:mean 4.3545068996075456, :std 30.266754180296076, :quantiles (1.0 1.0 1.0 2.0 2919.0)}"}
;; <=

;; @@
(let [counter (count user-posts)
      user-post-freqs (frequencies (vals (frequencies user-posts)))
      freq-vec (->> (map vector (keys user-post-freqs) (vals user-post-freqs))
                    (sort-by second >))]
  (plot/list-plot freq-vec :joined true))
;; @@
;; =>
;;; {"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"25b6d613-b852-4d2b-932f-7e96606be51a","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"25b6d613-b852-4d2b-932f-7e96606be51a","field":"data.y"}}],"marks":[{"type":"line","from":{"data":"25b6d613-b852-4d2b-932f-7e96606be51a"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"data":[{"name":"25b6d613-b852-4d2b-932f-7e96606be51a","values":[{"x":1,"y":37814},{"x":2,"y":9598},{"x":3,"y":4355},{"x":4,"y":2582},{"x":5,"y":1599},{"x":6,"y":1117},{"x":7,"y":784},{"x":8,"y":660},{"x":9,"y":507},{"x":10,"y":405},{"x":11,"y":369},{"x":12,"y":290},{"x":14,"y":232},{"x":13,"y":226},{"x":16,"y":173},{"x":15,"y":167},{"x":17,"y":146},{"x":19,"y":131},{"x":18,"y":114},{"x":20,"y":105},{"x":22,"y":93},{"x":21,"y":92},{"x":23,"y":79},{"x":24,"y":71},{"x":25,"y":65},{"x":26,"y":61},{"x":27,"y":58},{"x":29,"y":50},{"x":28,"y":50},{"x":30,"y":47},{"x":31,"y":45},{"x":33,"y":44},{"x":32,"y":43},{"x":35,"y":39},{"x":37,"y":33},{"x":39,"y":30},{"x":44,"y":29},{"x":34,"y":29},{"x":36,"y":27},{"x":48,"y":26},{"x":40,"y":26},{"x":42,"y":24},{"x":46,"y":23},{"x":41,"y":21},{"x":38,"y":21},{"x":43,"y":19},{"x":45,"y":19},{"x":54,"y":18},{"x":56,"y":17},{"x":63,"y":17},{"x":51,"y":16},{"x":52,"y":15},{"x":58,"y":14},{"x":60,"y":14},{"x":47,"y":14},{"x":53,"y":14},{"x":49,"y":13},{"x":69,"y":12},{"x":50,"y":12},{"x":68,"y":12},{"x":64,"y":11},{"x":70,"y":10},{"x":55,"y":10},{"x":61,"y":10},{"x":59,"y":9},{"x":66,"y":9},{"x":57,"y":9},{"x":79,"y":9},{"x":62,"y":8},{"x":67,"y":8},{"x":71,"y":8},{"x":72,"y":7},{"x":101,"y":7},{"x":92,"y":7},{"x":80,"y":7},{"x":76,"y":6},{"x":83,"y":6},{"x":65,"y":5},{"x":86,"y":5},{"x":85,"y":5},{"x":88,"y":5},{"x":77,"y":5},{"x":91,"y":5},{"x":89,"y":5},{"x":100,"y":5},{"x":82,"y":5},{"x":78,"y":5},{"x":96,"y":5},{"x":105,"y":5},{"x":114,"y":5},{"x":94,"y":5},{"x":102,"y":4},{"x":149,"y":4},{"x":106,"y":4},{"x":75,"y":4},{"x":109,"y":4},{"x":103,"y":4},{"x":152,"y":4},{"x":107,"y":4},{"x":97,"y":4},{"x":112,"y":4},{"x":140,"y":4},{"x":81,"y":4},{"x":98,"y":4},{"x":73,"y":4},{"x":74,"y":3},{"x":154,"y":3},{"x":95,"y":3},{"x":93,"y":3},{"x":134,"y":3},{"x":342,"y":3},{"x":115,"y":3},{"x":145,"y":3},{"x":132,"y":3},{"x":87,"y":3},{"x":84,"y":3},{"x":357,"y":2},{"x":188,"y":2},{"x":130,"y":2},{"x":210,"y":2},{"x":135,"y":2},{"x":239,"y":2},{"x":260,"y":2},{"x":222,"y":2},{"x":144,"y":2},{"x":99,"y":2},{"x":182,"y":2},{"x":117,"y":2},{"x":108,"y":2},{"x":156,"y":2},{"x":365,"y":2},{"x":178,"y":2},{"x":118,"y":2},{"x":131,"y":2},{"x":170,"y":2},{"x":125,"y":2},{"x":148,"y":2},{"x":142,"y":2},{"x":158,"y":2},{"x":127,"y":2},{"x":277,"y":2},{"x":255,"y":2},{"x":179,"y":2},{"x":245,"y":2},{"x":123,"y":2},{"x":133,"y":2},{"x":173,"y":2},{"x":147,"y":2},{"x":177,"y":2},{"x":950,"y":1},{"x":164,"y":1},{"x":430,"y":1},{"x":240,"y":1},{"x":110,"y":1},{"x":982,"y":1},{"x":128,"y":1},{"x":229,"y":1},{"x":153,"y":1},{"x":213,"y":1},{"x":1327,"y":1},{"x":491,"y":1},{"x":355,"y":1},{"x":175,"y":1},{"x":385,"y":1},{"x":269,"y":1},{"x":206,"y":1},{"x":217,"y":1},{"x":157,"y":1},{"x":204,"y":1},{"x":755,"y":1},{"x":1617,"y":1},{"x":192,"y":1},{"x":361,"y":1},{"x":137,"y":1},{"x":116,"y":1},{"x":645,"y":1},{"x":113,"y":1},{"x":136,"y":1},{"x":208,"y":1},{"x":241,"y":1},{"x":262,"y":1},{"x":263,"y":1},{"x":1400,"y":1},{"x":294,"y":1},{"x":358,"y":1},{"x":649,"y":1},{"x":1201,"y":1},{"x":257,"y":1},{"x":947,"y":1},{"x":347,"y":1},{"x":792,"y":1},{"x":90,"y":1},{"x":292,"y":1},{"x":498,"y":1},{"x":143,"y":1},{"x":247,"y":1},{"x":187,"y":1},{"x":195,"y":1},{"x":366,"y":1},{"x":196,"y":1},{"x":1992,"y":1},{"x":184,"y":1},{"x":219,"y":1},{"x":122,"y":1},{"x":231,"y":1},{"x":408,"y":1},{"x":111,"y":1},{"x":280,"y":1},{"x":198,"y":1},{"x":295,"y":1},{"x":808,"y":1},{"x":248,"y":1},{"x":261,"y":1},{"x":166,"y":1},{"x":252,"y":1},{"x":907,"y":1},{"x":482,"y":1},{"x":312,"y":1},{"x":520,"y":1},{"x":484,"y":1},{"x":180,"y":1},{"x":1816,"y":1},{"x":202,"y":1},{"x":266,"y":1},{"x":2919,"y":1},{"x":283,"y":1},{"x":449,"y":1},{"x":203,"y":1},{"x":1765,"y":1},{"x":700,"y":1},{"x":268,"y":1},{"x":163,"y":1},{"x":120,"y":1},{"x":126,"y":1},{"x":422,"y":1},{"x":124,"y":1},{"x":171,"y":1},{"x":160,"y":1},{"x":1738,"y":1},{"x":270,"y":1},{"x":271,"y":1},{"x":395,"y":1},{"x":185,"y":1},{"x":1962,"y":1},{"x":655,"y":1},{"x":318,"y":1},{"x":183,"y":1},{"x":2215,"y":1},{"x":362,"y":1}]}],"width":400,"height":247.2187957763672,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"25b6d613-b852-4d2b-932f-7e96606be51a\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"25b6d613-b852-4d2b-932f-7e96606be51a\", :field \"data.y\"}}], :marks [{:type \"line\", :from {:data \"25b6d613-b852-4d2b-932f-7e96606be51a\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :data [{:name \"25b6d613-b852-4d2b-932f-7e96606be51a\", :values ({:x 1, :y 37814} {:x 2, :y 9598} {:x 3, :y 4355} {:x 4, :y 2582} {:x 5, :y 1599} {:x 6, :y 1117} {:x 7, :y 784} {:x 8, :y 660} {:x 9, :y 507} {:x 10, :y 405} {:x 11, :y 369} {:x 12, :y 290} {:x 14, :y 232} {:x 13, :y 226} {:x 16, :y 173} {:x 15, :y 167} {:x 17, :y 146} {:x 19, :y 131} {:x 18, :y 114} {:x 20, :y 105} {:x 22, :y 93} {:x 21, :y 92} {:x 23, :y 79} {:x 24, :y 71} {:x 25, :y 65} {:x 26, :y 61} {:x 27, :y 58} {:x 29, :y 50} {:x 28, :y 50} {:x 30, :y 47} {:x 31, :y 45} {:x 33, :y 44} {:x 32, :y 43} {:x 35, :y 39} {:x 37, :y 33} {:x 39, :y 30} {:x 44, :y 29} {:x 34, :y 29} {:x 36, :y 27} {:x 48, :y 26} {:x 40, :y 26} {:x 42, :y 24} {:x 46, :y 23} {:x 41, :y 21} {:x 38, :y 21} {:x 43, :y 19} {:x 45, :y 19} {:x 54, :y 18} {:x 56, :y 17} {:x 63, :y 17} {:x 51, :y 16} {:x 52, :y 15} {:x 58, :y 14} {:x 60, :y 14} {:x 47, :y 14} {:x 53, :y 14} {:x 49, :y 13} {:x 69, :y 12} {:x 50, :y 12} {:x 68, :y 12} {:x 64, :y 11} {:x 70, :y 10} {:x 55, :y 10} {:x 61, :y 10} {:x 59, :y 9} {:x 66, :y 9} {:x 57, :y 9} {:x 79, :y 9} {:x 62, :y 8} {:x 67, :y 8} {:x 71, :y 8} {:x 72, :y 7} {:x 101, :y 7} {:x 92, :y 7} {:x 80, :y 7} {:x 76, :y 6} {:x 83, :y 6} {:x 65, :y 5} {:x 86, :y 5} {:x 85, :y 5} {:x 88, :y 5} {:x 77, :y 5} {:x 91, :y 5} {:x 89, :y 5} {:x 100, :y 5} {:x 82, :y 5} {:x 78, :y 5} {:x 96, :y 5} {:x 105, :y 5} {:x 114, :y 5} {:x 94, :y 5} {:x 102, :y 4} {:x 149, :y 4} {:x 106, :y 4} {:x 75, :y 4} {:x 109, :y 4} {:x 103, :y 4} {:x 152, :y 4} {:x 107, :y 4} {:x 97, :y 4} {:x 112, :y 4} {:x 140, :y 4} {:x 81, :y 4} {:x 98, :y 4} {:x 73, :y 4} {:x 74, :y 3} {:x 154, :y 3} {:x 95, :y 3} {:x 93, :y 3} {:x 134, :y 3} {:x 342, :y 3} {:x 115, :y 3} {:x 145, :y 3} {:x 132, :y 3} {:x 87, :y 3} {:x 84, :y 3} {:x 357, :y 2} {:x 188, :y 2} {:x 130, :y 2} {:x 210, :y 2} {:x 135, :y 2} {:x 239, :y 2} {:x 260, :y 2} {:x 222, :y 2} {:x 144, :y 2} {:x 99, :y 2} {:x 182, :y 2} {:x 117, :y 2} {:x 108, :y 2} {:x 156, :y 2} {:x 365, :y 2} {:x 178, :y 2} {:x 118, :y 2} {:x 131, :y 2} {:x 170, :y 2} {:x 125, :y 2} {:x 148, :y 2} {:x 142, :y 2} {:x 158, :y 2} {:x 127, :y 2} {:x 277, :y 2} {:x 255, :y 2} {:x 179, :y 2} {:x 245, :y 2} {:x 123, :y 2} {:x 133, :y 2} {:x 173, :y 2} {:x 147, :y 2} {:x 177, :y 2} {:x 950, :y 1} {:x 164, :y 1} {:x 430, :y 1} {:x 240, :y 1} {:x 110, :y 1} {:x 982, :y 1} {:x 128, :y 1} {:x 229, :y 1} {:x 153, :y 1} {:x 213, :y 1} {:x 1327, :y 1} {:x 491, :y 1} {:x 355, :y 1} {:x 175, :y 1} {:x 385, :y 1} {:x 269, :y 1} {:x 206, :y 1} {:x 217, :y 1} {:x 157, :y 1} {:x 204, :y 1} {:x 755, :y 1} {:x 1617, :y 1} {:x 192, :y 1} {:x 361, :y 1} {:x 137, :y 1} {:x 116, :y 1} {:x 645, :y 1} {:x 113, :y 1} {:x 136, :y 1} {:x 208, :y 1} {:x 241, :y 1} {:x 262, :y 1} {:x 263, :y 1} {:x 1400, :y 1} {:x 294, :y 1} {:x 358, :y 1} {:x 649, :y 1} {:x 1201, :y 1} {:x 257, :y 1} {:x 947, :y 1} {:x 347, :y 1} {:x 792, :y 1} {:x 90, :y 1} {:x 292, :y 1} {:x 498, :y 1} {:x 143, :y 1} {:x 247, :y 1} {:x 187, :y 1} {:x 195, :y 1} {:x 366, :y 1} {:x 196, :y 1} {:x 1992, :y 1} {:x 184, :y 1} {:x 219, :y 1} {:x 122, :y 1} {:x 231, :y 1} {:x 408, :y 1} {:x 111, :y 1} {:x 280, :y 1} {:x 198, :y 1} {:x 295, :y 1} {:x 808, :y 1} {:x 248, :y 1} {:x 261, :y 1} {:x 166, :y 1} {:x 252, :y 1} {:x 907, :y 1} {:x 482, :y 1} {:x 312, :y 1} {:x 520, :y 1} {:x 484, :y 1} {:x 180, :y 1} {:x 1816, :y 1} {:x 202, :y 1} {:x 266, :y 1} {:x 2919, :y 1} {:x 283, :y 1} {:x 449, :y 1} {:x 203, :y 1} {:x 1765, :y 1} {:x 700, :y 1} {:x 268, :y 1} {:x 163, :y 1} {:x 120, :y 1} {:x 126, :y 1} {:x 422, :y 1} {:x 124, :y 1} {:x 171, :y 1} {:x 160, :y 1} {:x 1738, :y 1} {:x 270, :y 1} {:x 271, :y 1} {:x 395, :y 1} {:x 185, :y 1} {:x 1962, :y 1} {:x 655, :y 1} {:x 318, :y 1} {:x 183, :y 1} {:x 2215, :y 1} {:x 362, :y 1})}], :width 400, :height 247.2188, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}
;; <=

;; **
;;; ## User Mentions
;; **

;; @@
(def user-mention-frequencies
  (->> (mc/find-maps @db "mentions")
       (map :user)
       frequencies))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/user-mention-frequencies</span>","value":"#'unsightly-reserve/user-mention-frequencies"}
;; <=

;; @@
(short-metrics (vals user-mention-frequencies))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>35.81539447190188</span>","value":"35.81539447190188"}],"value":"[:mean 35.81539447190188]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>840.0887399269913</span>","value":"840.0887399269913"}],"value":"[:std 840.0887399269913]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(1.0 1.0 2.0 6.0 52035.0)</span>","value":"(1.0 1.0 2.0 6.0 52035.0)"}],"value":"[:quantiles (1.0 1.0 2.0 6.0 52035.0)]"}],"value":"{:mean 35.81539447190188, :std 840.0887399269913, :quantiles (1.0 1.0 2.0 6.0 52035.0)}"}
;; <=

;; **
;;; ## Hashtags
;; **

;; @@
(def hashtag-frequencies
  (->> (mc/find-maps @db "publications")
       (map :hashtags)
       (remove nil?)
       flatten
       frequencies))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/hashtag-frequencies</span>","value":"#'unsightly-reserve/hashtag-frequencies"}
;; <=

;; @@
(short-metrics (vals hashtag-frequencies))
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>10.71760838553619</span>","value":"10.71760838553619"}],"value":"[:mean 10.71760838553619]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>103.53733078259982</span>","value":"103.53733078259982"}],"value":"[:std 103.53733078259982]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(1.0 1.0 2.0 4.0 6491.0)</span>","value":"(1.0 1.0 2.0 4.0 6491.0)"}],"value":"[:quantiles (1.0 1.0 2.0 4.0 6491.0)]"}],"value":"{:mean 10.71760838553619, :std 103.53733078259982, :quantiles (1.0 1.0 2.0 4.0 6491.0)}"}
;; <=

;; **
;;; ### Hashtags of one-time-users
;; **

;; @@
  (let [user-freq (->> (mc/find-maps @db "publications")
                       (map :user)
                       frequencies)]
    (->> user-freq
         (remove (fn [[k v]] (> v 1)))
         keys
         (map #(mc/find-one-as-map @db "publications" {:user %}))
         (map :hashtags)
         flatten
         (remove nil?)
         frequencies
         (sort-by second >)
         (take 25)
         (map (fn [[k v]] [(:text (mc/find-map-by-id @db "hashtags" k))
                          v]))))


;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Ferguson&quot;</span>","value":"\"Ferguson\""},{"type":"html","content":"<span class='clj-long'>506</span>","value":"506"}],"value":"[\"Ferguson\" 506]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Ukraine&quot;</span>","value":"\"Ukraine\""},{"type":"html","content":"<span class='clj-long'>445</span>","value":"445"}],"value":"[\"Ukraine\" 445]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;AFC&quot;</span>","value":"\"AFC\""},{"type":"html","content":"<span class='clj-long'>351</span>","value":"351"}],"value":"[\"AFC\" 351]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Kagawa&quot;</span>","value":"\"Kagawa\""},{"type":"html","content":"<span class='clj-long'>319</span>","value":"319"}],"value":"[\"Kagawa\" 319]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Gaza&quot;</span>","value":"\"Gaza\""},{"type":"html","content":"<span class='clj-long'>277</span>","value":"277"}],"value":"[\"Gaza\" 277]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;SOSCoveDolphins&quot;</span>","value":"\"SOSCoveDolphins\""},{"type":"html","content":"<span class='clj-long'>265</span>","value":"265"}],"value":"[\"SOSCoveDolphins\" 265]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;News&quot;</span>","value":"\"News\""},{"type":"html","content":"<span class='clj-long'>258</span>","value":"258"}],"value":"[\"News\" 258]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;BVB&quot;</span>","value":"\"BVB\""},{"type":"html","content":"<span class='clj-long'>255</span>","value":"255"}],"value":"[\"BVB\" 255]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;N24&quot;</span>","value":"\"N24\""},{"type":"html","content":"<span class='clj-long'>249</span>","value":"249"}],"value":"[\"N24\" 249]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Ebola&quot;</span>","value":"\"Ebola\""},{"type":"html","content":"<span class='clj-long'>226</span>","value":"226"}],"value":"[\"Ebola\" 226]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Israel&quot;</span>","value":"\"Israel\""},{"type":"html","content":"<span class='clj-long'>177</span>","value":"177"}],"value":"[\"Israel\" 177]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Germany&quot;</span>","value":"\"Germany\""},{"type":"html","content":"<span class='clj-long'>172</span>","value":"172"}],"value":"[\"Germany\" 172]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;ISIS&quot;</span>","value":"\"ISIS\""},{"type":"html","content":"<span class='clj-long'>172</span>","value":"172"}],"value":"[\"ISIS\" 172]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;RobinWilliams&quot;</span>","value":"\"RobinWilliams\""},{"type":"html","content":"<span class='clj-long'>165</span>","value":"165"}],"value":"[\"RobinWilliams\" 165]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;sltw14&quot;</span>","value":"\"sltw14\""},{"type":"html","content":"<span class='clj-long'>157</span>","value":"157"}],"value":"[\"sltw14\" 157]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Irak&quot;</span>","value":"\"Irak\""},{"type":"html","content":"<span class='clj-long'>156</span>","value":"156"}],"value":"[\"Irak\" 156]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;mufc&quot;</span>","value":"\"mufc\""},{"type":"html","content":"<span class='clj-long'>146</span>","value":"146"}],"value":"[\"mufc\" 146]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;IceBucketChallenge&quot;</span>","value":"\"IceBucketChallenge\""},{"type":"html","content":"<span class='clj-long'>139</span>","value":"139"}],"value":"[\"IceBucketChallenge\" 139]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;afc&quot;</span>","value":"\"afc\""},{"type":"html","content":"<span class='clj-long'>132</span>","value":"132"}],"value":"[\"afc\" 132]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;IS&quot;</span>","value":"\"IS\""},{"type":"html","content":"<span class='clj-long'>124</span>","value":"124"}],"value":"[\"IS\" 124]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;DalaiLama&quot;</span>","value":"\"DalaiLama\""},{"type":"html","content":"<span class='clj-long'>120</span>","value":"120"}],"value":"[\"DalaiLama\" 120]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Buddhist&quot;</span>","value":"\"Buddhist\""},{"type":"html","content":"<span class='clj-long'>119</span>","value":"119"}],"value":"[\"Buddhist\" 119]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;Russland&quot;</span>","value":"\"Russland\""},{"type":"html","content":"<span class='clj-long'>117</span>","value":"117"}],"value":"[\"Russland\" 117]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;EU&quot;</span>","value":"\"EU\""},{"type":"html","content":"<span class='clj-long'>106</span>","value":"106"}],"value":"[\"EU\" 106]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-string'>&quot;FCB&quot;</span>","value":"\"FCB\""},{"type":"html","content":"<span class='clj-long'>99</span>","value":"99"}],"value":"[\"FCB\" 99]"}],"value":"([\"Ferguson\" 506] [\"Ukraine\" 445] [\"AFC\" 351] [\"Kagawa\" 319] [\"Gaza\" 277] [\"SOSCoveDolphins\" 265] [\"News\" 258] [\"BVB\" 255] [\"N24\" 249] [\"Ebola\" 226] [\"Israel\" 177] [\"Germany\" 172] [\"ISIS\" 172] [\"RobinWilliams\" 165] [\"sltw14\" 157] [\"Irak\" 156] [\"mufc\" 146] [\"IceBucketChallenge\" 139] [\"afc\" 132] [\"IS\" 124] [\"DalaiLama\" 120] [\"Buddhist\" 119] [\"Russland\" 117] [\"EU\" 106] [\"FCB\" 99])"}
;; <=

;; **
;;; ## Post metrics
;; **

;; @@
(def source-uids (map :_id (mc/find-maps @db "users" {:screen_name {$in news-accounts}})))
(def source-publications (mc/find-maps @db "publications" {:user {$in source-uids}}))
(def user-publications (mc/find-maps @db "publications" {:user {$nin source-uids}}))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/user-publications</span>","value":"#'unsightly-reserve/user-publications"}
;; <=

;; @@
(let [user-pub-count (mc/count @db "publications" {:user {$nin source-uids}})
      source-pub-count (mc/count @db "publications" {:user {$in source-uids}})
      overall-pub-count (mc/count @db "publications")]
  [ ((comp float /) source-pub-count user-pub-count)
(plot/bar-chart ["user" "source"] [(/ user-pub-count overall-pub-count) (/ source-pub-count overall-pub-count)])])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-unkown'>0.07629545</span>","value":"0.07629545"},{"type":"vega","content":{"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"scales":[{"name":"x","type":"ordinal","range":"width","domain":{"data":"5e5e5db1-4c6a-4847-872b-9d3d173a9f66","field":"data.x"}},{"name":"y","range":"height","nice":true,"domain":{"data":"5e5e5db1-4c6a-4847-872b-9d3d173a9f66","field":"data.y"}}],"marks":[{"type":"rect","from":{"data":"5e5e5db1-4c6a-4847-872b-9d3d173a9f66"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"steelblue"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}}],"data":[{"name":"5e5e5db1-4c6a-4847-872b-9d3d173a9f66","values":[{"x":"user","y":0.9291129120180251},{"x":"source","y":0.07088708798197478}]}],"width":400,"height":247.2187957763672,"padding":{"bottom":20,"top":10,"right":10,"left":50}},"value":"#gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\", :values ({:x \"user\", :y 127832/137585} {:x \"source\", :y 9753/137585})}], :width 400, :height 247.2188, :padding {:bottom 20, :top 10, :right 10, :left 50}}}"}],"value":"[0.07629545 #gorilla_repl.vega.VegaView{:content {:axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\", :field \"data.y\"}}], :marks [{:type \"rect\", :from {:data \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}}], :data [{:name \"5e5e5db1-4c6a-4847-872b-9d3d173a9f66\", :values ({:x \"user\", :y 127832/137585} {:x \"source\", :y 9753/137585})}], :width 400, :height 247.2188, :padding {:bottom 20, :top 10, :right 10, :left 50}}}]"}
;; <=

;; **
;;; ### Source User Ratio
;; **

;; @@
(let [user-count (mc/count @db "users" {:screen_name {$nin news-accounts}})
      source-count (mc/count @db "users" {:screen_name {$in news-accounts}})
      overall-count (mc/count @db "users")]
    ((comp float /) source-count user-count))

;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>2.1431306E-4</span>","value":"2.1431306E-4"}
;; <=

;; **
;;; ### Average Source Post-Rate
;; **

;; @@
 (->> (map (fn [uid] [uid (mc/count @db "publications" {:user uid})]) source-uids)
       (map second)
       short-metrics)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>1393.2857142857142</span>","value":"1393.2857142857142"}],"value":"[:mean 1393.2857142857142]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>710.7663717177644</span>","value":"710.7663717177644"}],"value":"[:std 710.7663717177644]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(271.0 947.75 1472.0 1803.25 2919.0)</span>","value":"(271.0 947.75 1472.0 1803.25 2919.0)"}],"value":"[:quantiles (271.0 947.75 1472.0 1803.25 2919.0)]"}],"value":"{:mean 1393.2857142857142, :std 710.7663717177644, :quantiles (271.0 947.75 1472.0 1803.25 2919.0)}"}
;; <=

;; **
;;; ### Average User Post-Rate
;; **

;; @@
(->> (mc/find-maps @db "publications" {:user {$nin source-uids}})
       (map :user)
       frequencies
       vals
       short-metrics)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>4.046725125834943</span>","value":"4.046725125834943"}],"value":"[:mean 4.046725125834943]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>19.614712500426073</span>","value":"19.614712500426073"}],"value":"[:std 19.614712500426073]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(1.0 1.0 1.0 2.0 2215.0)</span>","value":"(1.0 1.0 1.0 2.0 2215.0)"}],"value":"[:quantiles (1.0 1.0 1.0 2.0 2215.0)]"}],"value":"{:mean 4.046725125834943, :std 19.614712500426073, :quantiles (1.0 1.0 1.0 2.0 2215.0)}"}
;; <=

;; **
;;; ### Post-Hour vs Count
;; **

;; @@
(letfn [(pub-time-dist 
          [pubs]
          (->> pubs
               (map (comp t/hour :ts))
               frequencies
               (sort-by first >)
               (map (fn [[k v]] [k (/ v (count pubs))]))))] 
  (plot/compose
    (plot/list-plot (pub-time-dist user-publications) :plot-size 600 :joined true :color "green" :plot-range [:all [0 0.1]])
    (plot/list-plot (pub-time-dist source-publications) :joined true :color "red")))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"8150592e-d94d-4e5b-b78c-1ba5b7dfa203","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":[0,0.1]}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"8150592e-d94d-4e5b-b78c-1ba5b7dfa203","values":[{"x":23,"y":0.03478784654859503},{"x":22,"y":0.04636945365792603},{"x":21,"y":0.04834470242192878},{"x":20,"y":0.05061330496276363},{"x":19,"y":0.05620658364102885},{"x":18,"y":0.05953517116215032},{"x":17,"y":0.05845171787971713},{"x":16,"y":0.05587020464359472},{"x":15,"y":0.06112319294073471},{"x":14,"y":0.06517147506101759},{"x":13,"y":0.0642327429751549},{"x":12,"y":0.06584032167219477},{"x":11,"y":0.06510498153826898},{"x":10,"y":0.06221838037424119},{"x":9,"y":0.06042696664371988},{"x":8,"y":0.04647114963389449},{"x":7,"y":0.02496245071656549},{"x":6,"y":0.01135474685524751},{"x":5,"y":0.006289504975280055},{"x":4,"y":0.005413355028474873},{"x":3,"y":0.005691063270542587},{"x":2,"y":0.008769322235434007},{"x":1,"y":0.01367419738406659},{"x":0,"y":0.02307716377745791}]},{"name":"b684cc53-f482-4b48-81eb-2a9151d0f0fe","values":[{"x":23,"y":0.01589254588331795},{"x":22,"y":0.03019583717830411},{"x":21,"y":0.03388700912539731},{"x":20,"y":0.03650158925458833},{"x":19,"y":0.04819030042038347},{"x":18,"y":0.06326258587101405},{"x":17,"y":0.07172152158310265},{"x":16,"y":0.07074746231928637},{"x":15,"y":0.07136265764380191},{"x":14,"y":0.07192658669127448},{"x":13,"y":0.06444171024300215},{"x":12,"y":0.0715164564749308},{"x":11,"y":0.07008100071772788},{"x":10,"y":0.06751768686557982},{"x":9,"y":0.0662360299395058},{"x":8,"y":0.05629037219317133},{"x":7,"y":0.0377319799036194},{"x":6,"y":0.01932738644519635},{"x":5,"y":0.009740592638162618},{"x":4,"y":0.00538295908951092},{"x":3,"y":0.004408899825694658},{"x":2,"y":0.003896237055265047},{"x":1,"y":0.004306367271608736},{"x":0,"y":0.005434225366553881}]}],"marks":[{"type":"line","from":{"data":"8150592e-d94d-4e5b-b78c-1ba5b7dfa203"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"green"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"b684cc53-f482-4b48-81eb-2a9151d0f0fe"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"red"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"8150592e-d94d-4e5b-b78c-1ba5b7dfa203\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain [0 0.1]}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"8150592e-d94d-4e5b-b78c-1ba5b7dfa203\", :values ({:x 23, :y 4447/127832} {:x 22, :y 11855/255664} {:x 21, :y 1545/31958} {:x 20, :y 3235/63916} {:x 19, :y 7185/127832} {:x 18, :y 15221/255664} {:x 17, :y 934/15979} {:x 16, :y 3571/63916} {:x 15, :y 15627/255664} {:x 14, :y 8331/127832} {:x 13, :y 8211/127832} {:x 12, :y 16833/255664} {:x 11, :y 16645/255664} {:x 10, :y 15907/255664} {:x 9, :y 15449/255664} {:x 8, :y 11881/255664} {:x 7, :y 3191/127832} {:x 6, :y 2903/255664} {:x 5, :y 201/31958} {:x 4, :y 173/31958} {:x 3, :y 1455/255664} {:x 2, :y 59/6728} {:x 1, :y 23/1682} {:x 0, :y 1475/63916})} {:name \"b684cc53-f482-4b48-81eb-2a9151d0f0fe\", :values ({:x 23, :y 155/9753} {:x 22, :y 589/19506} {:x 21, :y 661/19506} {:x 20, :y 356/9753} {:x 19, :y 470/9753} {:x 18, :y 617/9753} {:x 17, :y 1399/19506} {:x 16, :y 230/3251} {:x 15, :y 232/3251} {:x 14, :y 1403/19506} {:x 13, :y 419/6502} {:x 12, :y 465/6502} {:x 11, :y 1367/19506} {:x 10, :y 439/6502} {:x 9, :y 646/9753} {:x 8, :y 183/3251} {:x 7, :y 368/9753} {:x 6, :y 377/19506} {:x 5, :y 95/9753} {:x 4, :y 35/6502} {:x 3, :y 43/9753} {:x 2, :y 38/9753} {:x 1, :y 14/3251} {:x 0, :y 53/9753})}), :marks ({:type \"line\", :from {:data \"8150592e-d94d-4e5b-b78c-1ba5b7dfa203\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"green\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"b684cc53-f482-4b48-81eb-2a9151d0f0fe\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"red\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; **
;;; ### Post-day vs Count
;; **

;; @@
(letfn [(pub-time-dist 
          [pubs]
          (->> pubs
               (map (comp t/day :ts))
               frequencies
               (sort-by first >)
               (map (fn [[k v]] [k (/ v (count pubs))]))))] 
  (plot/compose
    (plot/list-plot (pub-time-dist user-publications) :joined true :color "green" :plot-size 600 :plot-range [:all [0 0.05]])
    (plot/list-plot (pub-time-dist source-publications) :joined true :color "red")))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"404d7747-d7b0-47a5-9295-c575fa275bc8","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":[0,0.05]}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"404d7747-d7b0-47a5-9295-c575fa275bc8","values":[{"x":31,"y":0.03808905438387884},{"x":30,"y":0.02617497966080481},{"x":29,"y":0.03307074910820452},{"x":28,"y":0.03820248451092058},{"x":27,"y":0.03182692909443645},{"x":26,"y":0.03264831966956631},{"x":25,"y":0.03004724951498842},{"x":24,"y":0.02531056386507291},{"x":23,"y":0.02524015895863321},{"x":22,"y":0.03025846423430753},{"x":21,"y":0.02939795982226673},{"x":20,"y":0.0338060892421303},{"x":19,"y":0.04348285249389824},{"x":18,"y":0.02823627886601164},{"x":17,"y":0.02746182489517492},{"x":16,"y":0.02795074785656174},{"x":15,"y":0.03556230051943175},{"x":14,"y":0.03694693034607923},{"x":13,"y":0.03892217911008198},{"x":12,"y":0.04144111020714688},{"x":11,"y":0.02722714187370924},{"x":10,"y":0.02942925089179548},{"x":9,"y":0.0238750860504412},{"x":8,"y":0.03199902997684461},{"x":7,"y":0.0416405907753927},{"x":6,"y":0.03661446273233619},{"x":5,"y":0.0342363414481507},{"x":4,"y":0.03462356843356906},{"x":3,"y":0.0324331935665561},{"x":2,"y":0.02357390950622692},{"x":1,"y":0.03027019838538081}]},{"name":"9e8a4c15-6779-4e07-a4fd-70cbb657b8cb","values":[{"x":31,"y":0.03552752999077207},{"x":30,"y":0.02747872449502717},{"x":29,"y":0.03552752999077207},{"x":28,"y":0.04106428791141187},{"x":27,"y":0.03532246488260023},{"x":26,"y":0.03983389726238081},{"x":25,"y":0.03583512765302984},{"x":24,"y":0.02450528042653542},{"x":23,"y":0.02553060596739465},{"x":22,"y":0.0352199323285143},{"x":21,"y":0.03563006254485799},{"x":20,"y":0.0352199323285143},{"x":19,"y":0.03803957756587717},{"x":18,"y":0.03075976622577668},{"x":17,"y":0.02265969445298882},{"x":16,"y":0.02353122116271916},{"x":15,"y":0.03809084384292013},{"x":14,"y":0.03916743566082231},{"x":13,"y":0.03542499743668615},{"x":12,"y":0.03409207423356916},{"x":11,"y":0.02978570696196042},{"x":10,"y":0.02383881882497693},{"x":9,"y":0.02306982466933251},{"x":8,"y":0.03419460678765508},{"x":7,"y":0.03450220444991285},{"x":6,"y":0.03557879626781503},{"x":5,"y":0.03368194401722547},{"x":4,"y":0.03363067774018251},{"x":3,"y":0.02496667691992208},{"x":2,"y":0.0213780375269148},{"x":1,"y":0.03691171947093202}]}],"marks":[{"type":"line","from":{"data":"404d7747-d7b0-47a5-9295-c575fa275bc8"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"green"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"9e8a4c15-6779-4e07-a4fd-70cbb657b8cb"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"stroke":{"value":"red"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"404d7747-d7b0-47a5-9295-c575fa275bc8\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain [0 0.05]}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"404d7747-d7b0-47a5-9295-c575fa275bc8\", :values ({:x 31, :y 4869/127832} {:x 30, :y 1673/63916} {:x 29, :y 445/13456} {:x 28, :y 9767/255664} {:x 27, :y 8137/255664} {:x 26, :y 8347/255664} {:x 25, :y 3841/127832} {:x 24, :y 6471/255664} {:x 23, :y 6453/255664} {:x 22, :y 967/31958} {:x 21, :y 1879/63916} {:x 20, :y 8643/255664} {:x 19, :y 11117/255664} {:x 18, :y 7219/255664} {:x 17, :y 7021/255664} {:x 16, :y 3573/127832} {:x 15, :y 2273/63916} {:x 14, :y 4723/127832} {:x 13, :y 9951/255664} {:x 12, :y 10595/255664} {:x 11, :y 6961/255664} {:x 10, :y 99/3364} {:x 9, :y 763/31958} {:x 8, :y 8181/255664} {:x 7, :y 5323/127832} {:x 6, :y 9361/255664} {:x 5, :y 8753/255664} {:x 4, :y 2213/63916} {:x 3, :y 2073/63916} {:x 2, :y 6027/255664} {:x 1, :y 7739/255664})} {:name \"9e8a4c15-6779-4e07-a4fd-70cbb657b8cb\", :values ({:x 31, :y 231/6502} {:x 30, :y 268/9753} {:x 29, :y 231/6502} {:x 28, :y 267/6502} {:x 27, :y 689/19506} {:x 26, :y 259/6502} {:x 25, :y 233/6502} {:x 24, :y 239/9753} {:x 23, :y 83/3251} {:x 22, :y 229/6502} {:x 21, :y 695/19506} {:x 20, :y 229/6502} {:x 19, :y 371/9753} {:x 18, :y 100/3251} {:x 17, :y 221/9753} {:x 16, :y 153/6502} {:x 15, :y 743/19506} {:x 14, :y 382/9753} {:x 13, :y 691/19506} {:x 12, :y 665/19506} {:x 11, :y 581/19506} {:x 10, :y 155/6502} {:x 9, :y 75/3251} {:x 8, :y 667/19506} {:x 7, :y 673/19506} {:x 6, :y 347/9753} {:x 5, :y 219/6502} {:x 4, :y 328/9753} {:x 3, :y 487/19506} {:x 2, :y 139/6502} {:x 1, :y 120/3251})}), :marks ({:type \"line\", :from {:data \"404d7747-d7b0-47a5-9295-c575fa275bc8\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"green\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"9e8a4c15-6779-4e07-a4fd-70cbb657b8cb\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :stroke {:value \"red\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; **
;;; ### Publication Types
;; **

;; @@
(let [user-type-freq (->> (mc/find-maps @db "publications")
                          (map :type)
                          frequencies)
      source-type-freq (->> source-publications
                          (map :type)
                          frequencies)]
  (plot/compose
    (plot/bar-chart (keys user-type-freq) (vals user-type-freq) :plot-size 600)
    (plot/bar-chart (keys source-type-freq) (vals source-type-freq) :colour "green" )))
;; @@
;; =>
;;; {"type":"vega","content":{"width":600,"height":370.82818603515625,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"ordinal","range":"width","domain":{"data":"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1","field":"data.x"}},{"name":"y","range":"height","nice":true,"domain":{"data":"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1","field":"data.y"}}],"axes":[{"scale":"x","type":"x"},{"scale":"y","type":"y"}],"data":[{"name":"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1","values":[{"x":"source","y":15682},{"x":"retweet","y":137833},{"x":"unrelated","y":585},{"x":"reply","y":51629},{"x":"share","y":69441}]},{"name":"54bb9496-3edd-4874-9124-3ba7a1b01909","values":[{"x":"source","y":15682},{"x":"retweet","y":2867},{"x":"reply","y":376},{"x":"unrelated","y":581}]}],"marks":[{"type":"rect","from":{"data":"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"steelblue"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}},{"type":"rect","from":{"data":"54bb9496-3edd-4874-9124-3ba7a1b01909"},"properties":{"enter":{"y":{"scale":"y","field":"data.y"},"width":{"offset":-1,"scale":"x","band":true},"x":{"scale":"x","field":"data.x"},"y2":{"scale":"y","value":0}},"update":{"fill":{"value":"green"},"opacity":{"value":1}},"hover":{"fill":{"value":"#FF29D2"}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 600, :height 370.8282, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"ordinal\", :range \"width\", :domain {:data \"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1\", :field \"data.x\"}} {:name \"y\", :range \"height\", :nice true, :domain {:data \"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1\", :field \"data.y\"}}], :axes [{:scale \"x\", :type \"x\"} {:scale \"y\", :type \"y\"}], :data ({:name \"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1\", :values ({:x \"source\", :y 15682} {:x \"retweet\", :y 137833} {:x \"unrelated\", :y 585} {:x \"reply\", :y 51629} {:x \"share\", :y 69441})} {:name \"54bb9496-3edd-4874-9124-3ba7a1b01909\", :values ({:x \"source\", :y 15682} {:x \"retweet\", :y 2867} {:x \"reply\", :y 376} {:x \"unrelated\", :y 581})}), :marks ({:type \"rect\", :from {:data \"67acb2e7-ae7f-40c3-bc5f-e80d264c6ad1\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"steelblue\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}} {:type \"rect\", :from {:data \"54bb9496-3edd-4874-9124-3ba7a1b01909\"}, :properties {:enter {:y {:scale \"y\", :field \"data.y\"}, :width {:offset -1, :scale \"x\", :band true}, :x {:scale \"x\", :field \"data.x\"}, :y2 {:scale \"y\", :value 0}}, :update {:fill {:value \"green\"}, :opacity {:value 1}}, :hover {:fill {:value \"#FF29D2\"}}}})}}"}
;; <=

;; **
;;; ### Post Delays
;; **

;; @@
(def all-delays
  (let [users (map :_id (mc/find-maps @db "users" {:screen_name {$in news-accounts}}))]
    (->> (mc/find-maps @db "publications" {:user {$in users}
                                           :ts {$lt (t/date-time 2014 9 1)}})
         (pmap (comp :delays analyzer/analyze-delays analyzer/full-reaction-tree :_id))
         flatten
         (remove #(= 0 %))
         (pmap (comp float #(/ % 60)))
         vec
         time)))	
;; @@
;; ->
;;; &quot;Elapsed time: 19441.923037 msecs&quot;
;;; 
;; <-
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;unsightly-reserve/all-delays</span>","value":"#'unsightly-reserve/all-delays"}
;; <=

;; @@
(short-metrics all-delays)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:mean</span>","value":":mean"},{"type":"html","content":"<span class='clj-double'>255.12439145997513</span>","value":"255.12439145997513"}],"value":"[:mean 255.12439145997513]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:std</span>","value":":std"},{"type":"html","content":"<span class='clj-double'>2973.8437219054367</span>","value":"2973.8437219054367"}],"value":"[:std 2973.8437219054367]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:quantiles</span>","value":":quantiles"},{"type":"html","content":"<span class='clj-unkown'>(0.01666666753590107 6.166666507720947 25.950000762939453 105.91666412353516 180445.3125)</span>","value":"(0.01666666753590107 6.166666507720947 25.950000762939453 105.91666412353516 180445.3125)"}],"value":"[:quantiles (0.01666666753590107 6.166666507720947 25.950000762939453 105.91666412353516 180445.3125)]"}],"value":"{:mean 255.12439145997513, :std 2973.8437219054367, :quantiles (0.01666666753590107 6.166666507720947 25.950000762939453 105.91666412353516 180445.3125)}"}
;; <=

;; @@

;; @@
